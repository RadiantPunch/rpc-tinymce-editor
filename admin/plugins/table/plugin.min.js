!function(y){"use strict";var n,t,e,r,o,i,a=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=function(n){return function(){return n}},c=u(!1),l=u(!0),x={noop:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t]},noarg:function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return e()}},compose:function(e,r){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return e(r.apply(null,arguments))}},constant:u,identity:function(n){return n},tripleEquals:function(n,t){return n===t},curry:function(i){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];for(var a=new Array(arguments.length-1),e=1;e<arguments.length;e++)a[e-1]=arguments[e];return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var o=a.concat(e);return i.apply(null,o)}},not:function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return!e.apply(null,arguments)}},die:function(n){return function(){throw new Error(n)}},apply:function(n){return n()},call:function(n){n()},never:c,always:l},s=x.never,f=x.always,d=function(){return m},m=(r={fold:function(n,t){return n()},is:s,isSome:s,isNone:f,getOr:e=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},or:e,orThunk:t,map:d,ap:d,each:function(){},bind:d,flatten:d,exists:s,forall:f,filter:d,equals:n=function(n){return n.isNone()},equals_:n,toArray:function(){return[]},toString:x.constant("none()")},Object.freeze&&Object.freeze(r),r),g=function(e){var n=function(){return e},t=function(){return o},r=function(n){return n(e)},o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:f,isNone:s,getOr:n,getOrThunk:n,getOrDie:n,or:t,orThunk:t,map:function(n){return g(n(e))},ap:function(n){return n.fold(d,function(n){return g(n(e))})},each:function(n){n(e)},bind:r,flatten:n,exists:r,forall:r,filter:function(n){return n(e)?o:m},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(s,function(n){return t(e,n)})},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return o},R={some:g,none:d,from:function(n){return null==n?m:g(n)}},p=function(t){return function(n){return function(n){if(null===n)return"null";var t=typeof n;return"object"===t&&Array.prototype.isPrototypeOf(n)?"array":"object"===t&&String.prototype.isPrototypeOf(n)?"string":t}(n)===t}},C={isString:p("string"),isObject:p("object"),isArray:p("array"),isNull:p("null"),isBoolean:p("boolean"),isUndefined:p("undefined"),isFunction:p("function"),isNumber:p("number")},h=void 0===(o=Array.prototype.indexOf)?function(n,t){return k(n,t)}:function(n,t){return o.call(n,t)},v=function(n,t){return-1<h(n,t)},b=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o,n)}return r},w=function(n,t){for(var e=0,r=n.length;e<r;e++)t(n[e],e,n)},S=function(n,t){for(var e=n.length-1;0<=e;e--)t(n[e],e,n)},T=function(n,t){for(var e=[],r=0,o=n.length;r<o;r++){var i=n[r];t(i,r,n)&&e.push(i)}return e},D=function(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e],e,n))return R.some(e);return R.none()},k=function(n,t){for(var e=0,r=n.length;e<r;++e)if(n[e]===t)return e;return-1},O=Array.prototype.push,A=function(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!Array.prototype.isPrototypeOf(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);O.apply(t,n[e])}return t},P=function(n,t){for(var e=0,r=n.length;e<r;++e)if(!0!==t(n[e],e,n))return!1;return!0},N=Array.prototype.slice,B=C.isFunction(Array.from)?Array.from:function(n){return N.call(n)},E={map:b,each:w,eachr:S,partition:function(n,t){for(var e=[],r=[],o=0,i=n.length;o<i;o++){var a=n[o];(t(a,o,n)?e:r).push(a)}return{pass:e,fail:r}},filter:T,groupBy:function(n,t){if(0===n.length)return[];for(var e=t(n[0]),r=[],o=[],i=0,a=n.length;i<a;i++){var u=n[i],c=t(u);c!==e&&(r.push(o),o=[]),e=c,o.push(u)}return 0!==o.length&&r.push(o),r},indexOf:function(n,t){var e=h(n,t);return-1===e?R.none():R.some(e)},foldr:function(n,t,e){return S(n,function(n){e=t(e,n)}),e},foldl:function(n,t,e){return w(n,function(n){e=t(e,n)}),e},find:function(n,t){for(var e=0,r=n.length;e<r;e++){var o=n[e];if(t(o,e,n))return R.some(o)}return R.none()},findIndex:D,flatten:A,bind:function(n,t){var e=b(n,t);return A(e)},forall:P,exists:function(n,t){return D(n,t).isSome()},contains:v,equal:function(n,e){return n.length===e.length&&P(n,function(n,t){return n===e[t]})},reverse:function(n){var t=N.call(n,0);return t.reverse(),t},chunk:function(n,t){for(var e=[],r=0;r<n.length;r+=t){var o=n.slice(r,r+t);e.push(o)}return e},difference:function(n,t){return T(n,function(n){return!v(t,n)})},mapToObject:function(n,t){for(var e={},r=0,o=n.length;r<o;r++){var i=n[r];e[String(i)]=t(i,r)}return e},pure:function(n){return[n]},sort:function(n,t){var e=N.call(n,0);return e.sort(t),e},range:function(n,t){for(var e=[],r=0;r<n;r++)e.push(t(r));return e},head:function(n){return 0===n.length?R.none():R.some(n[0])},last:function(n){return 0===n.length?R.none():R.some(n[n.length-1])},from:B},I=void 0===(i=Object.keys)?function(n){var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t}:i,W=function(n,t){for(var e=I(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i,n)}},M=function(r,o){var i={};return W(r,function(n,t){var e=o(n,t,r);i[e.k]=e.v}),i},q=function(n,e){var r=[];return W(n,function(n,t){r.push(e(n,t))}),r},j=function(n){return q(n,function(n){return n})},z={bifilter:function(n,e){var r={},o={};return W(n,function(n,t){(e(n,t)?r:o)[t]=n}),{t:r,f:o}},each:W,map:function(n,r){return M(n,function(n,t,e){return{k:t,v:r(n,t,e)}})},mapToArray:q,tupleMap:M,find:function(n,t){for(var e=I(n),r=0,o=e.length;r<o;r++){var i=e[r],a=n[i];if(t(a,i,n))return R.some(a)}return R.none()},keys:I,values:j,size:function(n){return j(n).length}},_=function(n){return n.slice(0).sort()},L=function(n,t){throw new Error("All required keys ("+_(n).join(", ")+") were not specified. Specified keys were: "+_(t).join(", ")+".")},F=function(n){throw new Error("Unsupported keys for object: "+_(n).join(", "))},H=function(t,n){if(!C.isArray(n))throw new Error("The "+t+" fields must be an array. Was: "+n+".");E.each(n,function(n){if(!C.isString(n))throw new Error("The value "+n+" in the "+t+" fields was not a string.")})},V=function(n,t){throw new Error("All values need to be of type: "+t+". Keys ("+_(n).join(", ")+") were not.")},U=function(n){var e=_(n);E.find(e,function(n,t){return t<e.length-1&&n===e[t+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+e.join(", ")+"].")})},G={immutable:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t.length!==e.length)throw new Error('Wrong number of arguments to struct. Expected "['+t.length+']", got '+e.length+" arguments");var r={};return E.each(t,function(n,t){r[n]=x.constant(e[t])}),r}},immutableBag:function(o,i){var a=o.concat(i);if(0===a.length)throw new Error("You must specify at least one required or optional field.");return H("required",o),H("optional",i),U(a),function(t){var e=z.keys(t);E.forall(o,function(n){return E.contains(e,n)})||L(o,e);var n=E.filter(e,function(n){return!E.contains(a,n)});0<n.length&&F(n);var r={};return E.each(o,function(n){r[n]=x.constant(t[n])}),E.each(i,function(n){r[n]=x.constant(Object.prototype.hasOwnProperty.call(t,n)?R.some(t[n]):R.none())}),r}}},X=G.immutable("width","height"),Y=G.immutable("rows","columns"),K=G.immutable("row","column"),J=G.immutable("x","y"),$=G.immutable("element","rowspan","colspan"),Q=G.immutable("element","rowspan","colspan","isNew"),Z={dimensions:X,grid:Y,address:K,coords:J,extended:G.immutable("element","rowspan","colspan","row","column"),detail:$,detailnew:Q,rowdata:G.immutable("element","cells","section"),elementnew:G.immutable("element","isNew"),rowdatanew:G.immutable("element","cells","section","isNew"),rowcells:G.immutable("cells","section"),rowdetails:G.immutable("details","section"),bounds:G.immutable("startRow","startCol","finishRow","finishCol")},nn=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:x.constant(n)}},tn=(y={fromHtml:function(n,t){var e=(t||document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||1<e.childNodes.length)throw console.error("HTML does not have a single root node",n),"HTML must have a single root node";return nn(e.childNodes[0])},fromTag:function(n,t){var e=(t||document).createElement(n);return nn(e)},fromText:function(n,t){var e=(t||document).createTextNode(n);return nn(e)},fromDom:nn,fromPoint:function(n,t,e){return R.from(n.dom().elementFromPoint(t,e)).map(nn)}},function(n){return 1!==n.nodeType&&9!==n.nodeType||0===n.childElementCount}),en={all:function(n,t){var e=void 0===t?document:t.dom();return tn(e)?[]:E.map(e.querySelectorAll(n),y.fromDom)},is:function(n,t){var e=n.dom();if(1!==e.nodeType)return!1;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},one:function(n,t){var e=void 0===t?document:t.dom();return tn(e)?R.none():R.from(e.querySelector(n)).map(y.fromDom)}},rn=function(n,t){for(var e=[],r=function(n){return e.push(n),t(n)},o=t(n);(o=o.bind(r)).isSome(););return e},on="undefined"!=typeof window?window:Function("return this;")(),an=function(n,t){return function(n,t){for(var e=null!=t?t:on,r=0;r<n.length&&null!=e;++r)e=e[n[r]];return e}(n.split("."),t)},un=function(){return function(n,t){var e=an(n,t);if(null==e)throw n+" not available on this browser";return e}("Node")},cn=function(n){var t,e=!1;return function(){return e||(e=!0,t=n.apply(null,arguments)),t}},ln=function(){return sn(0,0)},sn=function(n,t){return{major:n,minor:t}},fn=function(n,t){var e=String(t).toLowerCase();return 0===n.length?ln():function(n,t){var e=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(r.test(t))return r}}(n,t);if(!e)return{major:0,minor:0};var r=function(n){return Number(t.replace(e,"$"+n))};return sn(r(1),r(2))}(n,e)},dn=ln,mn="Firefox",gn=function(n,t){return function(){return t===n}},pn=function(n){var t=n.current;return{current:t,version:n.version,isEdge:gn("Edge",t),isChrome:gn("Chrome",t),isIE:gn("IE",t),isOpera:gn("Opera",t),isFirefox:gn(mn,t),isSafari:gn("Safari",t)}},hn=function(){return pn({current:void 0,version:dn()})},vn=pn,bn=(x.constant("Edge"),x.constant("Chrome"),x.constant("IE"),x.constant("Opera"),x.constant(mn),x.constant("Safari"),"Windows"),wn="Android",yn="Solaris",xn="FreeBSD",Rn=function(n,t){return function(){return t===n}},Cn=function(n){var t=n.current;return{current:t,version:n.version,isWindows:Rn(bn,t),isiOS:Rn("iOS",t),isAndroid:Rn(wn,t),isOSX:Rn("OSX",t),isLinux:Rn("Linux",t),isSolaris:Rn(yn,t),isFreeBSD:Rn(xn,t)}},Sn=function(){return Cn({current:void 0,version:dn()})},Tn=Cn,Dn=(x.constant(bn),x.constant("iOS"),x.constant(wn),x.constant("Linux"),x.constant("OSX"),x.constant(yn),x.constant(xn),function(n,t){var e=String(t).toLowerCase();return E.find(n,function(n){return n.search(e)})}),kn=function(n,t,e){return""===t||!(n.length<t.length)&&n.substr(e,e+t.length)===t},On=function(n,t){return kn(n,t,n.length-t.length)},An=On,Pn=function(n,t){return-1!==n.indexOf(t)},Nn=function(n){return n.replace(/^\s+|\s+$/g,"")},Bn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,En=function(t){return function(n){return Pn(n,t)}},In=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return Pn(n,"edge/")&&Pn(n,"chrome")&&Pn(n,"safari")&&Pn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Bn],search:function(n){return Pn(n,"chrome")&&!Pn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return Pn(n,"msie")||Pn(n,"trident")}},{name:"Opera",versionRegexes:[Bn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:En("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:En("firefox")},{name:"Safari",versionRegexes:[Bn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(Pn(n,"safari")||Pn(n,"mobile/"))&&Pn(n,"applewebkit")}}],Wn=[{name:"Windows",search:En("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return Pn(n,"iphone")||Pn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:En("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:En("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:En("linux"),versionRegexes:[]},{name:"Solaris",search:En("sunos"),versionRegexes:[]},{name:"FreeBSD",search:En("freebsd"),versionRegexes:[]}],Mn={browsers:x.constant(In),oses:x.constant(Wn)},qn=function(n){var t,e,r,o,i,a,u,c,l,s,f,d,m,g,p,h=Mn.browsers(),v=Mn.oses(),b=(g=h,p=n,Dn(g,p).map(function(n){var t=fn(n.versionRegexes,p);return{current:n.name,version:t}})).fold(hn,vn),w=(d=v,m=n,Dn(d,m).map(function(n){var t=fn(n.versionRegexes,m);return{current:n.name,version:t}})).fold(Sn,Tn);return{browser:b,os:w,deviceType:(e=b,r=n,o=(t=w).isiOS()&&!0===/ipad/i.test(r),i=t.isiOS()&&!o,a=t.isAndroid()&&3===t.version.major,u=t.isAndroid()&&4===t.version.major,c=o||a||u&&!0===/mobile/i.test(r),l=t.isiOS()||t.isAndroid(),s=l&&!c,f=e.isSafari()&&t.isiOS()&&!1===/safari/i.test(r),{isiPad:x.constant(o),isiPhone:x.constant(i),isTablet:x.constant(c),isPhone:x.constant(s),isTouch:x.constant(l),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:x.constant(f)})}},jn={detect:cn(function(){var n=navigator.userAgent;return qn(n)})},zn=function(n,t){return n.dom()===t.dom()},_n=jn.detect().browser.isIE()?function(n,t){return e=n.dom(),r=t.dom(),o=e,i=r,a=un().DOCUMENT_POSITION_CONTAINED_BY,0!=(o.compareDocumentPosition(i)&a);var e,r,o,i,a}:function(n,t){var e=n.dom(),r=t.dom();return e!==r&&e.contains(r)},Ln={eq:zn,isEqualNode:function(n,t){return n.dom().isEqualNode(t.dom())},member:function(n,t){return E.exists(t,x.curry(zn,n))},contains:_n,is:en.is},Fn=function(n){return y.fromDom(n.dom().ownerDocument)},Hn=function(n){var t=n.dom();return R.from(t.parentNode).map(y.fromDom)},Vn=function(n){var t=n.dom();return R.from(t.previousSibling).map(y.fromDom)},Un=function(n){var t=n.dom();return R.from(t.nextSibling).map(y.fromDom)},Gn=function(n){var t=n.dom();return E.map(t.childNodes,y.fromDom)},Xn=function(n,t){var e=n.dom().childNodes;return R.from(e[t]).map(y.fromDom)},Yn=G.immutable("element","offset"),Kn={owner:Fn,defaultView:function(n){var t=n.dom().ownerDocument.defaultView;return y.fromDom(t)},documentElement:function(n){var t=Fn(n);return y.fromDom(t.dom().documentElement)},parent:Hn,findIndex:function(e){return Hn(e).bind(function(n){var t=Gn(n);return E.findIndex(t,function(n){return Ln.eq(e,n)})})},parents:function(n,t){for(var e=C.isFunction(t)?t:x.constant(!1),r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,a=y.fromDom(i);if(o.push(a),!0===e(a))break;r=i}return o},siblings:function(t){return Hn(t).map(Gn).map(function(n){return E.filter(n,function(n){return!Ln.eq(t,n)})}).getOr([])},prevSibling:Vn,offsetParent:function(n){var t=n.dom();return R.from(t.offsetParent).map(y.fromDom)},prevSiblings:function(n){return E.reverse(rn(n,Vn))},nextSibling:Un,nextSiblings:function(n){return rn(n,Un)},children:Gn,child:Xn,firstChild:function(n){return Xn(n,0)},lastChild:function(n){return Xn(n,n.dom().childNodes.length-1)},childNodesCount:function(n){return n.dom().childNodes.length},hasChildNodes:function(n){return n.dom().hasChildNodes()},leaf:function(n,t){var e=Gn(n);return 0<e.length&&t<e.length?Yn(e[t],0):Yn(n,t)}},Jn=function(n,t,e){return E.bind(Kn.children(n),function(n){return en.is(n,t)?e(n)?[n]:[]:Jn(n,t,e)})},$n={firstLayer:function(n,t){return Jn(n,t,x.constant(!0))},filterFirstLayer:Jn},Qn=function(n){return n.dom().nodeName.toLowerCase()},Zn=function(n){return n.dom().nodeType},nt=function(t){return function(n){return Zn(n)===t}},tt=nt(1),et=nt(3),rt=nt(9),ot={name:Qn,type:Zn,value:function(n){return n.dom().nodeValue},isElement:tt,isText:et,isDocument:rt,isComment:function(n){return 8===Zn(n)||"#comment"===Qn(n)}},it=function(n,t,e){if(!(C.isString(e)||C.isBoolean(e)||C.isNumber(e)))throw console.error("Invalid call to Attr.set. Key ",t,":: Value ",e,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,e+"")},at=function(n,t,e){it(n.dom(),t,e)},ut=function(n,t){var e=n.dom().getAttribute(t);return null===e?void 0:e},ct=function(n,t){var e=n.dom();return!(!e||!e.hasAttribute)&&e.hasAttribute(t)},lt={clone:function(n){return E.foldl(n.dom().attributes,function(n,t){return n[t.name]=t.value,n},{})},set:at,setAll:function(n,t){var e=n.dom();z.each(t,function(n,t){it(e,t,n)})},get:ut,has:ct,remove:function(n,t){n.dom().removeAttribute(t)},hasNone:function(n){var t=n.dom().attributes;return null==t||0===t.length},transfer:function(o,i,n){ot.isElement(o)&&ot.isElement(i)&&E.each(n,function(n){var t,e,r;e=i,ct(t=o,r=n)&&!ct(e,r)&&at(e,r,ut(t,r))})}},st=cn(function(){return ft(y.fromDom(document))}),ft=function(n){var t=n.dom().body;if(null==t)throw"Body is not available yet";return y.fromDom(t)},dt={body:st,getBody:ft,inBody:function(n){var t=ot.isText(n)?n.dom().parentNode:n.dom();return null!=t&&t.ownerDocument.body.contains(t)}},mt=function(n,t){var e=[];return E.each(Kn.children(n),function(n){t(n)&&(e=e.concat([n])),e=e.concat(mt(n,t))}),e},gt={all:function(n){return mt(dt.body(),n)},ancestors:function(n,t,e){return E.filter(Kn.parents(n,e),t)},siblings:function(n,t){return E.filter(Kn.siblings(n),t)},children:function(n,t){return E.filter(Kn.children(n),t)},descendants:mt},pt={all:function(n){return en.all(n)},ancestors:function(n,t,e){return gt.ancestors(n,function(n){return en.is(n,t)},e)},siblings:function(n,t){return gt.siblings(n,function(n){return en.is(n,t)})},children:function(n,t){return gt.children(n,function(n){return en.is(n,t)})},descendants:function(n,t){return en.all(t,n)}};function ht(n,t,e,r,o){return n(e,r)?R.some(e):C.isFunction(o)&&o(e)?R.none():t(e,r,o)}var vt,bt,wt,yt,xt=function(n,t,e){for(var r=n.dom(),o=C.isFunction(e)?e:x.constant(!1);r.parentNode;){r=r.parentNode;var i=y.fromDom(r);if(t(i))return R.some(i);if(o(i))break}return R.none()},Rt=function(n,t){return E.find(n.dom().childNodes,x.compose(t,y.fromDom)).map(y.fromDom)},Ct=function(n,r){var o=function(n){for(var t=0;t<n.childNodes.length;t++){if(r(y.fromDom(n.childNodes[t])))return R.some(y.fromDom(n.childNodes[t]));var e=o(n.childNodes[t]);if(e.isSome())return e}return R.none()};return o(n.dom())},St={first:function(n){return Ct(dt.body(),n)},ancestor:xt,closest:function(n,t,e){return ht(function(n){return t(n)},xt,n,t,e)},sibling:function(t,e){var n=t.dom();return n.parentNode?Rt(y.fromDom(n.parentNode),function(n){return!Ln.eq(t,n)&&e(n)}):R.none()},child:Rt,descendant:Ct},Tt=function(n,t,e){return St.ancestor(n,function(n){return en.is(n,t)},e)},Dt={first:function(n){return en.one(n)},ancestor:Tt,sibling:function(n,t){return St.sibling(n,function(n){return en.is(n,t)})},child:function(n,t){return St.child(n,function(n){return en.is(n,t)})},descendant:function(n,t){return en.one(t,n)},closest:function(n,t,e){return ht(en.is,Tt,n,t,e)}},kt=function(n,t,e){var r=void 0!==e?e:x.constant(!1);return r(t)?R.none():E.contains(n,ot.name(t))?R.some(t):Dt.ancestor(t,n.join(","),function(n){return en.is(n,"table")||r(n)})},Ot=function(t,n){return Kn.parent(n).map(function(n){return pt.children(n,t)})},At=(x.curry(Ot,"th,td"),x.curry(Ot,"tr"),function(n,t){return kt(["td","th"],n,t)}),Pt=function(n){return $n.firstLayer(n,"th,td")},Nt=function(n,t){return Dt.closest(n,"table",t)},Bt=function(n){return $n.firstLayer(n,"tr")},Et=function(n){var t=Bt(n);return E.map(t,function(n){var t=n,e=Kn.parent(t).bind(function(n){var t=ot.name(n);return"tfoot"===t||"thead"===t||"tbody"===t?t:"tbody"}),r=E.map(Pt(n),function(n){var t=lt.has(n,"rowspan")?parseInt(lt.get(n,"rowspan"),10):1,e=lt.has(n,"colspan")?parseInt(lt.get(n,"colspan"),10):1;return Z.detail(n,t,e)});return Z.rowdata(t,r,e)})},It=function(n,t){return n+","+t},Wt=function(n,t){var e=E.bind(n.all(),function(n){return n.cells()});return E.filter(e,t)},Mt=function(n){var s={},t=[],e=n.length,f=0;E.each(n,function(n,c){var l=[];E.each(n.cells(),function(n,t){for(var e=0;void 0!==s[It(c,e)];)e++;for(var r=Z.extended(n.element(),n.rowspan(),n.colspan(),c,e),o=0;o<n.colspan();o++)for(var i=0;i<n.rowspan();i++){var a=e+o,u=It(c+i,a);s[u]=r,f=Math.max(f,a+1)}l.push(r)}),t.push(Z.rowdata(n.element(),l,n.section()))});var r=Z.grid(e,f);return{grid:x.constant(r),access:x.constant(s),all:x.constant(t)}},qt=function(n,t,e){var r=n.access()[It(t,e)];return void 0!==r?R.some(r):R.none()},jt=function(n,t,e){var r=Wt(n,function(n){return e(t,n.element())});return 0<r.length?R.some(r[0]):R.none()},zt=Wt,_t=function(n){var t=E.map(n.all(),function(n){return n.cells()});return E.flatten(t)},Lt=function(n){return void 0!==n.style},Ft=function(n,t,e){if(!C.isString(e))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",e,":: Element ",n),new Error("CSS value must be a string: "+e);Lt(n)&&n.style.setProperty(t,e)},Ht=function(n,t){Lt(n)&&n.style.removeProperty(t)},Vt=function(n,t,e){var r=n.dom();Ft(r,t,e)},Ut=function(n,t){return Lt(n)?n.style.getPropertyValue(t):""},Gt=function(n,t){var e=n.dom(),r=Ut(e,t);return R.from(r).filter(function(n){return 0<n.length})},Xt={copy:function(n,t){var e=n.dom(),r=t.dom();Lt(e)&&Lt(r)&&(r.style.cssText=e.style.cssText)},set:Vt,preserve:function(n,t){var e=lt.get(n,"style"),r=t(n);return(void 0===e?lt.remove:lt.set)(n,"style",e),r},setAll:function(n,t){var e=n.dom();z.each(t,function(n,t){Ft(e,t,n)})},setOptions:function(n,t){var e=n.dom();z.each(t,function(n,t){n.fold(function(){Ht(e,t)},function(n){Ft(e,t,n)})})},remove:function(n,t){var e=n.dom();Ht(e,t),lt.has(n,"style")&&""===Nn(lt.get(n,"style"))&&lt.remove(n,"style")},get:function(n,t){var e=n.dom(),r=window.getComputedStyle(e).getPropertyValue(t),o=""!==r||dt.inBody(n)?r:Ut(e,t);return null===o?void 0:o},getRaw:Gt,getAllRaw:function(n){var t={},e=n.dom();if(Lt(e))for(var r=0;r<e.style.length;r++){var o=e.style.item(r);t[o]=e.style[o]}return t},isValidValue:function(n,t,e){var r=y.fromTag(n);return Vt(r,t,e),Gt(r,t).isSome()},reflow:function(n){return n.dom().offsetWidth},transfer:function(r,o,n){ot.isElement(r)&&ot.isElement(o)&&E.each(n,function(n){var t,e;t=o,Gt(r,e=n).each(function(n){Gt(t,e).isNone()&&Vt(t,e,n)})})}},Yt=function(t,e){Kn.parent(t).each(function(n){n.dom().insertBefore(e.dom(),t.dom())})},Kt=function(n,t){n.dom().appendChild(t.dom())},Jt={before:Yt,after:function(n,t){Kn.nextSibling(n).fold(function(){Kn.parent(n).each(function(n){Kt(n,t)})},function(n){Yt(n,t)})},prepend:function(t,e){Kn.firstChild(t).fold(function(){Kt(t,e)},function(n){t.dom().insertBefore(e.dom(),n.dom())})},append:Kt,appendAt:function(n,t,e){Kn.child(n,e).fold(function(){Kt(n,t)},function(n){Yt(n,t)})},wrap:function(n,t){Yt(n,t),Kt(t,n)}},$t={before:function(t,n){E.each(n,function(n){Jt.before(t,n)})},after:function(r,o){E.each(o,function(n,t){var e=0===t?r:o[t-1];Jt.after(e,n)})},prepend:function(t,n){E.each(n.slice().reverse(),function(n){Jt.prepend(t,n)})},append:function(t,n){E.each(n,function(n){Jt.append(t,n)})}},Qt=function(n){var t=n.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Zt={empty:function(n){n.dom().textContent="",E.each(Kn.children(n),function(n){Qt(n)})},remove:Qt,unwrap:function(n){var t=Kn.children(n);0<t.length&&$t.before(n,t),Qt(n)}},ne=G.immutable("minRow","minCol","maxRow","maxCol"),te=function(n,t){return y.fromDom(n.dom().cloneNode(t))},ee=function(n){return te(n,!0)},re=function(n){return te(n,!1)},oe=ee,ie=function(n,t){var e,r,o,i=(e=n,r=y.fromTag(t),o=lt.clone(e),lt.setAll(r,o),r),a=Kn.children(ee(n));return $t.append(i,a),i},ae=(vt=ot.isText,"text",bt=function(n){return vt(n)?R.from(n.dom().nodeValue):R.none()},wt=jn.detect().browser,{get:function(n){if(!vt(n))throw new Error("Can only get text value of a text node");return yt(n).getOr("")},getOption:yt=wt.isIE()&&10===wt.version.major?function(n){try{return bt(n)}catch(n){return R.none()}}:bt,set:function(n,t){if(!vt(n))throw new Error("Can only set raw text value of a text node");n.dom().nodeValue=t}}),ue={get:function(n){return ae.get(n)},getOption:function(n){return ae.getOption(n)},set:function(n,t){ae.set(n,t)}},ce=["img","br"],le=function(n){return"img"===ot.name(n)?1:ue.getOption(n).fold(function(){return Kn.children(n).length},function(n){return n.length})},se=function(n){return ue.getOption(n).filter(function(n){return 0!==n.trim().length||-1<n.indexOf(" ")}).isSome()||E.contains(ce,ot.name(n))},fe=function(n){return St.descendant(n,se)},de=function(n){return i=se,(a=function(n){for(var t=Kn.children(n),e=t.length-1;0<=e;e--){var r=t[e];if(i(r))return R.some(r);var o=a(r);if(o.isSome())return o}return R.none()})(n);var i,a},me=function(){var n=y.fromTag("td");return Jt.append(n,y.fromTag("br")),n},ge=function(n,t,e){var r=ie(n,t);return z.each(e,function(n,t){null===n?lt.remove(r,t):lt.set(r,t,n)}),r},pe=function(n){return n},he=function(n){return function(){return y.fromTag("tr",n.dom())}},ve=function(c,n,l){return{row:he(n),cell:function(n){var r,o,i,t=Kn.owner(n.element()),e=y.fromTag(ot.name(n.element()),t.dom()),a=l.getOr(["strong","em","b","i","span","font","h1","h2","h3","h4","h5","h6","p","div"]),u=0<a.length?(r=n.element(),o=e,i=a,fe(r).map(function(n){var t=i.join(","),e=pt.ancestors(n,t,function(n){return Ln.eq(n,r)});return E.foldr(e,function(n,t){var e=re(t);return Jt.append(n,e),e},o)}).getOr(o)):e;return Jt.append(u,y.fromTag("br")),Xt.copy(n.element(),e),Xt.remove(e,"height"),1!==n.colspan()&&Xt.remove(n.element(),"width"),c(n.element(),e),e},replace:ge,gap:me}},be=function(n){return{row:he(n),cell:me,replace:pe,gap:me}},we=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];function ye(){return{up:x.constant({selector:Dt.ancestor,closest:Dt.closest,predicate:St.ancestor,all:Kn.parents}),down:x.constant({selector:pt.descendants,predicate:gt.descendants}),styles:x.constant({get:Xt.get,getRaw:Xt.getRaw,set:Xt.set,remove:Xt.remove}),attrs:x.constant({get:lt.get,set:lt.set,remove:lt.remove,copyTo:function(n,t){var e=lt.clone(n);lt.setAll(t,e)}}),insert:x.constant({before:Jt.before,after:Jt.after,afterAll:$t.after,append:Jt.append,appendAll:$t.append,prepend:Jt.prepend,wrap:Jt.wrap}),remove:x.constant({unwrap:Zt.unwrap,remove:Zt.remove}),create:x.constant({nu:y.fromTag,clone:function(n){return y.fromDom(n.dom().cloneNode(!1))},text:y.fromText}),query:x.constant({comparePosition:function(n,t){return n.dom().compareDocumentPosition(t.dom())},prevSibling:Kn.prevSibling,nextSibling:Kn.nextSibling}),property:x.constant({children:Kn.children,name:ot.name,parent:Kn.parent,isText:ot.isText,isComment:ot.isComment,isElement:ot.isElement,getText:ue.get,setText:ue.set,isBoundary:function(n){return!!ot.isElement(n)&&("body"===ot.name(n)||E.contains(we,ot.name(n)))},isEmptyTag:function(n){return!!ot.isElement(n)&&E.contains(["br","img","hr","input"],ot.name(n))}}),eq:Ln.eq,is:Ln.is}}G.immutable("left","right");var xe=function(t,n,e){return n.bind(function(n){return e.filter(x.curry(t.eq,n))})},Re=function(n,t,e){return 0<e.length?(r=n,o=t,i=(c=e)[0],a=c.slice(1),u=o(r,i),E.foldr(a,function(n,t){var e=o(r,t);return xe(r,n,e)},u)):R.none();var r,o,i,a,u,c},Ce=function(e,n,t,r){var o=void 0!==r?r:x.constant(!1),i=[n].concat(e.up().all(n)),a=[t].concat(e.up().all(t)),u=function(t){return E.findIndex(t,o).fold(function(){return t},function(n){return t.slice(0,n+1)})},c=u(i),l=u(a),s=E.find(c,function(n){return E.exists(l,(t=n,x.curry(e.eq,t)));var t});return{firstpath:x.constant(c),secondpath:x.constant(l),shared:x.constant(s)}},Se=ye(),Te=function(e,n){return Re(Se,function(n,t){return e(t)},n)},De=function(n,t,e){return Ce(Se,n,t,e)},ke=function(n,t){return t.column()>=n.startCol()&&t.column()+t.colspan()-1<=n.finishCol()&&t.row()>=n.startRow()&&t.row()+t.rowspan()-1<=n.finishRow()},Oe=function(n,t){var e=t.column(),r=t.column()+t.colspan()-1,o=t.row(),i=t.row()+t.rowspan()-1;return e<=n.finishCol()&&r>=n.startCol()&&o<=n.finishRow()&&i>=n.startRow()},Ae=function(n,t,e){var r=jt(n,t,Ln.eq),o=jt(n,e,Ln.eq);return r.bind(function(r){return o.map(function(n){return t=r,e=n,Z.bounds(Math.min(t.row(),e.row()),Math.min(t.column(),e.column()),Math.max(t.row()+t.rowspan()-1,e.row()+e.rowspan()-1),Math.max(t.column()+t.colspan()-1,e.column()+e.colspan()-1));var t,e})})},Pe=Ae,Ne=function(t,n,e){return Ae(t,n,e).bind(function(n){return function(n,t){for(var e=!0,r=x.curry(ke,t),o=t.startRow();o<=t.finishRow();o++)for(var i=t.startCol();i<=t.finishCol();i++)e=e&&qt(n,o,i).exists(r);return e?R.some(t):R.none()}(t,n)})},Be=function(e,n,t){return Pe(e,n,t).map(function(n){var t=zt(e,x.curry(Oe,n));return E.map(t,function(n){return n.element()})})},Ee=function(n,t){return jt(n,t,function(n,t){return Ln.contains(t,n)}).bind(function(n){return n.element()})},Ie=function(n){var t=Et(n);return Mt(t)},We=function(e,a,u){return Nt(e).bind(function(n){var r,o,i,t=Ie(n);return o=a,i=u,jt(r=t,e,Ln.eq).bind(function(n){var t=0<o?n.row()+n.rowspan()-1:n.row(),e=0<i?n.column()+n.colspan()-1:n.column();return qt(r,t+o,e+i).map(function(n){return n.element()})})})},Me=function(n,t,e,r,o){var i=Ie(n),a=Ln.eq(n,e)?t:Ee(i,t),u=Ln.eq(n,o)?r:Ee(i,r);return Be(i,a,u)},qe=function(n,t){return Dt.ancestor(n,"table")},je=G.immutableBag(["boxes","start","finish"],[]),ze=function(l,s,f){var d=function(t){return function(n){return f(n)||Ln.eq(n,t)}};return Ln.eq(l,s)?R.some(je({boxes:R.some([l]),start:l,finish:s})):qe(l).bind(function(c){return qe(s).bind(function(i){if(Ln.eq(c,i))return R.some(je({boxes:(n=c,t=l,e=s,r=Ie(n),Be(r,t,e)),start:l,finish:s}));var n,t,e,r;if(Ln.contains(c,i)){var o=0<(a=pt.ancestors(s,"td,th",d(c))).length?a[a.length-1]:s;return R.some(je({boxes:Me(c,l,c,s,i),start:l,finish:o}))}if(Ln.contains(i,c)){var a,u=0<(a=pt.ancestors(l,"td,th",d(i))).length?a[a.length-1]:l;return R.some(je({boxes:Me(i,l,c,s,i),start:l,finish:u}))}return De(l,s).shared().bind(function(n){return Dt.closest(n,"table",f).bind(function(n){var t=pt.ancestors(s,"td,th",d(n)),e=0<t.length?t[t.length-1]:s,r=pt.ancestors(l,"td,th",d(n)),o=0<r.length?r[r.length-1]:l;return R.some(je({boxes:Me(n,l,c,s,i),start:o,finish:e}))})})})})},_e=ze,Le=function(n,t){var e=pt.descendants(n,t);return 0<e.length?R.some(e):R.none()},Fe=function(n,t,e,r,o){return(i=n,a=o,E.find(i,function(n){return en.is(n,a)})).bind(function(n){return We(n,t,e).bind(function(n){return e=r,Dt.ancestor(t=n,"table").bind(function(n){return Dt.descendant(n,e).bind(function(n){return ze(n,t).bind(function(t){return t.boxes().map(function(n){return{boxes:x.constant(n),start:x.constant(t.start()),finish:x.constant(t.finish())}})})})});var t,e})});var i,a},He=function(n,t,r){return Dt.descendant(n,t).bind(function(e){return Dt.descendant(n,r).bind(function(t){return Te(qe,[e,t]).map(function(n){return{first:x.constant(e),last:x.constant(t),table:x.constant(n)}})})})},Ve=function(r,n,t){return He(r,n,t).bind(function(a){var n=function(n){return Ln.eq(r,n)},t=Dt.ancestor(a.first(),"thead,tfoot,tbody,table",n),e=Dt.ancestor(a.last(),"thead,tfoot,tbody,table",n);return t.bind(function(i){return e.bind(function(n){return Ln.eq(i,n)?(t=a.table(),e=a.first(),r=a.last(),o=Ie(t),Ne(o,e,r)):R.none();var t,e,r,o})})})},Ue={selected:x.constant("data-mce-selected"),selectedSelector:x.constant("td[data-mce-selected],th[data-mce-selected]"),attributeSelector:x.constant("[data-mce-selected]"),firstSelected:x.constant("data-mce-first-selected"),firstSelectedSelector:x.constant("td[data-mce-first-selected],th[data-mce-first-selected]"),lastSelected:x.constant("data-mce-last-selected"),lastSelectedSelector:x.constant("td[data-mce-last-selected],th[data-mce-last-selected]")},Ge=function(a){if(!C.isArray(a))throw new Error("cases must be an array");if(0===a.length)throw new Error("there must be at least one case");var u=[],e={};return E.each(a,function(n,r){var t=z.keys(n);if(1!==t.length)throw new Error("one and only one name per case");var o=t[0],i=n[o];if(void 0!==e[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!C.isArray(i))throw new Error("case arguments must be an array");u.push(o),e[o]=function(){var n=arguments.length;if(n!==i.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+i.length+" ("+i+"), got "+n);for(var e=new Array(n),t=0;t<e.length;t++)e[t]=arguments[t];return{fold:function(){if(arguments.length!==a.length)throw new Error("Wrong number of arguments to fold. Expected "+a.length+", got "+arguments.length);return arguments[r].apply(null,e)},match:function(n){var t=z.keys(n);if(u.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+u.join(",")+"\nActual: "+t.join(","));if(!E.forall(u,function(n){return E.contains(t,n)}))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+u.join(", "));return n[o].apply(null,e)},log:function(n){console.log(n,{constructors:u,constructor:o,params:e})}}}}),e},Xe=Ge([{none:[]},{multiple:["elements"]},{single:["selection"]}]),Ye={cata:function(n,t,e,r){return n.fold(t,e,r)},none:Xe.none,multiple:Xe.multiple,single:Xe.single},Ke=function(n,t){return Ye.cata(t.get(),x.constant([]),x.identity,x.constant([n]))},Je=Ke,$e=function(n){return{element:x.constant(n),mergable:R.none,unmergable:R.none,selection:x.constant([n])}},Qe=G.immutable("element","clipboard","generators"),Ze={noMenu:$e,forMenu:function(n,t,e){return{element:x.constant(e),mergable:x.constant((a=t,u=n,Ye.cata(u.get(),R.none,function(t,n){return 0===t.length?R.none():Ve(a,Ue.firstSelectedSelector(),Ue.lastSelectedSelector()).bind(function(n){return 1<t.length?R.some({bounds:x.constant(n),cells:x.constant(t)}):R.none()})},R.none))),unmergable:x.constant((r=e,o=n,i=Ke(r,o),0<i.length&&E.forall(i,function(n){return lt.has(n,"rowspan")&&1<parseInt(lt.get(n,"rowspan"),10)||lt.has(n,"colspan")&&1<parseInt(lt.get(n,"colspan"),10)})?R.some(i):R.none())),selection:x.constant(Je(e,n))};var r,o,i,a,u},notCell:function(n){return $e(n)},paste:Qe,pasteRows:function(n,t,e,r,o){return{element:x.constant(e),mergable:R.none,unmergable:R.none,selection:x.constant(Je(e,n)),clipboard:x.constant(r),generators:x.constant(o)}}},nr=function(s,n,f,d){s.on("BeforeGetContent",function(e){!0===e.selection&&Ye.cata(n.get(),x.noop,function(n){var t;e.preventDefault(),(t=n,Nt(t[0]).map(oe).map(function(n){return[(t=n,e=Ue.attributeSelector(),m=function(n){return en.is(n.element(),e)},g=Et(t),p=Mt(g),i=m,o=(r=p).grid().columns(),a=r.grid().rows(),u=o,l=c=0,z.each(r.access(),function(n){if(i(n)){var t=n.row(),e=t+n.rowspan()-1,r=n.column(),o=r+n.colspan()-1;t<a?a=t:c<e&&(c=e),r<u?u=r:l<o&&(l=o)}}),h=ne(a,u,c,l),v="th:not("+e+"),td:not("+e+")",b=$n.filterFirstLayer(t,"th,td",function(n){return en.is(n,v)}),E.each(b,Zt.remove),function(n,t,e,r){for(var o,i,a,u=t.grid().columns(),c=t.grid().rows(),l=0;l<c;l++)for(var s=!1,f=0;f<u;f++)l<e.minRow()||l>e.maxRow()||f<e.minCol()||f>e.maxCol()||(qt(t,l,f).filter(r).isNone()?(o=s,i=n[l].element(),a=y.fromTag("td"),Jt.append(a,y.fromTag("br")),(o?Jt.append:Jt.prepend)(i,a)):s=!0)}(g,p,h,m),s=t,f=h,d=E.filter($n.firstLayer(s,"tr"),function(n){return 0===n.dom().childElementCount}),E.each(d,Zt.remove),f.minCol()!==f.maxCol()&&f.minRow()!==f.maxRow()||E.each($n.firstLayer(s,"th,td"),function(n){lt.remove(n,"rowspan"),lt.remove(n,"colspan")}),lt.remove(s,"width"),lt.remove(s,"height"),Xt.remove(s,"width"),Xt.remove(s,"height"),t)];var t,e,r,i,o,a,u,c,l,s,f,d,m,g,p,h,v,b})).each(function(n){e.content=E.map(n,function(n){return t=n,s.selection.serializer.serialize(t.dom(),{});var t}).join("")})},x.noop)}),s.on("BeforeSetContent",function(l){!0===l.selection&&!0===l.paste&&R.from(s.dom.getParent(s.selection.getStart(),"th,td")).each(function(n){var c=y.fromDom(n);Nt(c).bind(function(t){var n,e,r,o=E.filter((n=l.content,(r=(e||document).createElement("div")).innerHTML=n,Kn.children(y.fromDom(r))),function(n){return"meta"!==ot.name(n)});if(1===o.length&&"table"===ot.name(o[0])){l.preventDefault();var i=y.fromDom(s.getDoc()),a=be(i),u=Ze.paste(c,o[0],a);f.pasteCells(t,u).each(function(n){s.selection.setRng(n),s.focus(),d.clear(t)})}})})})};function tr(r,o){var n=function(n){var t=o(n);if(t<=0||null===t){var e=Xt.get(n,r);return parseFloat(e)||0}return t},i=function(o,n){return E.foldl(n,function(n,t){var e=Xt.get(o,t),r=void 0===e?0:parseInt(e,10);return isNaN(r)?n:n+r},0)};return{set:function(n,t){if(!C.isNumber(t)&&!t.match(/^[0-9]+$/))throw r+".set accepts only positive integer values. Value was "+t;var e=n.dom();Lt(e)&&(e.style[r]=t+"px")},get:n,getOuter:n,aggregate:i,max:function(n,t,e){var r=i(n,e);return r<t?t-r:0}}}var er=tr("height",function(n){return dt.inBody(n)?n.dom().getBoundingClientRect().height:n.dom().offsetHeight}),rr=function(n){return er.get(n)},or=function(n){return er.getOuter(n)},ir=tr("width",function(n){return n.dom().offsetWidth}),ar=function(n){return ir.get(n)},ur=function(n){return ir.getOuter(n)},cr=jn.detect(),lr=function(n,t,e){return r=Xt.get(n,t),o=e,i=parseFloat(r),isNaN(i)?o:i;var r,o,i},sr=/(\d+(\.\d+)?)(\w|%)*/,fr=/(\d+(\.\d+)?)%/,dr=/(\d+(\.\d+)?)px|em/,mr=function(n,t){Xt.set(n,"height",t+"px")},gr=function(n){var u,t,e,r,o,i,a,c,l,s,f=Xt.getRaw(u=n,"height").getOrThunk(function(){return n=u,(cr.browser.isIE()||cr.browser.isEdge()?(e=lr(t=n,"padding-top",0),r=lr(t,"padding-bottom",0),o=lr(t,"border-top-width",0),i=lr(t,"border-bottom-width",0),a=t.dom().getBoundingClientRect().height,"border-box"===Xt.get(t,"box-sizing")?a:a-e-r-(o+i)):lr(n,"height",rr(n)))+"px";var n,t,e,r,o,i,a});return f?(t=f,e=n,r=rr,o=mr,s=parseInt(t,10),An(t,"%")&&"table"!==ot.name(e)?(a=s,c=r,o(i=e,l=Nt(i).map(function(n){var t=c(n);return Math.floor(a/100*t)}).getOr(a)),l):s):rr(n)},pr=function(n){return Xt.getRaw(n,"width").fold(function(){return R.from(lt.get(n,"width"))},function(n){return R.some(n)})},hr=function(n,t){return n/t.pixelWidth()*100},vr={percentageBasedSizeRegex:x.constant(fr),pixelBasedSizeRegex:x.constant(dr),setPixelWidth:function(n,t){Xt.set(n,"width",t+"px")},setPercentageWidth:function(n,t){Xt.set(n,"width",t+"%")},setHeight:mr,getPixelWidth:function(t,e){return pr(t).fold(function(){var n=ar(t);return parseInt(n,10)},function(n){return function(n,t,e){if(dr.test(t)){var r=dr.exec(t);return parseInt(r[1],10)}if(fr.test(t)){var o=fr.exec(t);return parseFloat(o[1])/100*e.pixelWidth()}var i=ar(n);return parseInt(i,10)}(t,n,e)})},getPercentageWidth:function(e,r){return pr(e).fold(function(){var n=ar(e),t=parseInt(n,10);return hr(t,r)},function(n){return function(n,t,e){if(fr.test(t)){var r=fr.exec(t);return parseFloat(r[1])}var o=ar(n),i=parseInt(o,10);return hr(i,e)}(e,n,r)})},getGenericWidth:function(n){return pr(n).bind(function(n){if(sr.test(n)){var t=sr.exec(n);return R.some({width:x.constant(t[1]),unit:x.constant(t[3])})}return R.none()})},setGenericWidth:function(n,t,e){Xt.set(n,"width",t+e)},getHeight:function(n){return"rowspan",gr(r=n)/(lt.has(t=r,e="rowspan")?parseInt(lt.get(t,e),10):1);var t,e,r},getRawWidth:pr},br=function(e,r){vr.getGenericWidth(e).each(function(n){var t=n.width()/2;vr.setGenericWidth(e,t,n.unit()),vr.setGenericWidth(r,t,n.unit())})},wr=function(e,r){return{left:x.constant(e),top:x.constant(r),translate:function(n,t){return wr(e+n,r+t)}}},yr=function(n,t){return void 0!==n?n:void 0!==t?t:0},xr=function(n){var t,e,r,o=n.dom(),i=o.ownerDocument,a=i.body,u=y.fromDom(i.documentElement);return a===o?wr(a.offsetLeft,a.offsetTop):(e=n,r=u||y.fromDom(document.documentElement),St.ancestor(e,x.curry(Ln.eq,r)).isSome()?(t=o.getBoundingClientRect(),wr(t.left,t.top)):wr(0,0))},Rr=function(n){var t,e,r=n.dom().ownerDocument,o=r.body,i=(t=y.fromDom(r),(e=t.dom())===e.window?t:ot.isDocument(t)?e.defaultView||e.parentWindow:null),a=r.documentElement,u=yr(i.pageYOffset,a.scrollTop),c=yr(i.pageXOffset,a.scrollLeft),l=yr(a.clientTop,o.clientTop),s=yr(a.clientLeft,o.clientLeft);return xr(n).translate(c-s,u-l)},Cr=G.immutable("row","y"),Sr=G.immutable("col","x"),Tr=function(n){return Rr(n).left()+ur(n)},Dr=function(n){return Rr(n).left()},kr=function(n,t){return Sr(n,Dr(t))},Or=function(n,t){return Sr(n,Tr(t))},Ar=function(n){return Rr(n).top()},Pr=function(e,t,r){if(0===r.length)return[];var n=E.map(r.slice(1),function(n,t){return n.map(function(n){return e(t,n)})}),o=r[r.length-1].map(function(n){return t(r.length-1,n)});return n.concat([o])},Nr={delta:x.identity,positions:x.curry(Pr,function(n,t){return Cr(n,Ar(t))},function(n,t){return Cr(n,Ar(t)+or(t))}),edge:Ar},Br={delta:x.identity,edge:Dr,positions:x.curry(Pr,kr,Or)},Er={height:Nr,rtl:{delta:function(n,t){return-n},edge:Tr,positions:x.curry(Pr,Or,kr)},ltr:Br},Ir={ltr:Er.ltr,rtl:Er.rtl};function Wr(t){var e=function(n){return t(n).isRtl()?Ir.rtl:Ir.ltr};return{delta:function(n,t){return e(t).delta(n,t)},edge:function(n){return e(n).edge(n)},positions:function(n,t){return e(t).positions(n,t)}}}var Mr=function(n){var t=Et(n);return Mt(t).grid()},qr=function(n){var t=n,e=function(){return t};return{get:e,set:function(n){t=n},clone:function(){return qr(e())}}},jr=function(n,t){return zr(n,t,{validate:C.isFunction,label:"function"})},zr=function(r,o,i){if(0===o.length)throw new Error("You must specify at least one required field.");return H("required",o),U(o),function(t){var e=z.keys(t);E.forall(o,function(n){return E.contains(e,n)})||L(o,e),r(o,e);var n=E.filter(o,function(n){return!i.validate(t[n],n)});return 0<n.length&&V(n,i.label),t}},_r=x.noop,Lr={exactly:x.curry(jr,function(t,n){var e=E.filter(n,function(n){return!E.contains(t,n)});0<e.length&&F(e)}),ensure:x.curry(jr,_r),ensureWith:x.curry(zr,_r)},Fr=function(n){var t=lt.has(n,"colspan")?parseInt(lt.get(n,"colspan"),10):1,e=lt.has(n,"rowspan")?parseInt(lt.get(n,"rowspan"),10):1;return{element:x.constant(n),colspan:x.constant(t),rowspan:x.constant(e)}},Hr=Lr.exactly(["cell","row","replace","gap"]),Vr=function(r,n){Hr(r);var o=qr(R.none()),i=void 0!==n?n:Fr,a=function(n){var t,e=(t=i(n),r.cell(t));return o.get().isNone()&&o.set(R.some(e)),u=R.some({item:n,replacement:e}),e},u=R.none();return{getOrInit:function(t,e){return u.fold(function(){return a(t)},function(n){return e(t,n.item)?n.replacement:a(t)})},cursor:o.get}},Ur=function(o,u){return function(e){var r=qr(R.none());Hr(e);var i=[],a=function(n){var t=e.replace(n,u,{scope:o});return i.push({item:n,sub:t}),r.get().isNone()&&r.set(R.some(t)),t};return{replaceOrInit:function(t,e){return(r=t,o=e,E.find(i,function(n){return o(n.item,r)})).fold(function(){return a(t)},function(n){return e(t,n.item)?n.sub:a(t)});var r,o},cursor:r.get}}},Gr=function(e){Hr(e);var n=qr(R.none());return{combine:function(t){return n.get().isNone()&&n.set(R.some(t)),function(){var n=e.cell({element:x.constant(t),colspan:x.constant(1),rowspan:x.constant(1)});return Xt.remove(n,"width"),Xt.remove(t,"width"),n}},cursor:n.get}},Xr=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","table","thead","tfoot","tbody","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"],Yr=function(n,t){var e=n.property().name(t);return E.contains(Xr,e)},Kr=function(n,t){return E.contains(["br","img","hr","input"],n.property().name(t))},Jr=ye(),$r=function(n){return Yr(Jr,n)},Qr=function(n){return t=n,e=Jr.property().name(t),E.contains(["ol","ul"],e);var t,e},Zr=function(n){var t,i=function(n){return"br"===ot.name(n)},r=function(o){return de(o).bind(function(e){var r=Kn.nextSibling(e).map(function(n){return!!$r(n)||(Kr(Jr,n)?"img"!==ot.name(n):void 0)}).getOr(!1);return Kn.parent(e).map(function(n){return!0===r||(t=n,"li"===ot.name(t)||St.ancestor(t,Qr).isSome())||i(e)||$r(n)&&!Ln.eq(o,n)?[]:[y.fromTag("br")];var t})}).getOr([])},e=0===(t=E.bind(n,function(n){var t,e=Kn.children(n);return t=e,E.forall(t,function(n){return i(n)||ot.isText(n)&&0===ue.get(n).trim().length})?[]:e.concat(r(n))})).length?[y.fromTag("br")]:t;Zt.empty(n[0]),$t.append(n[0],e)},no=function(a){return function(){for(var n=new Array(arguments.length),t=0;t<n.length;t++)n[t]=arguments[t];if(0===n.length)throw new Error("Can't merge zero objects");for(var e={},r=0;r<n.length;r++){var o=n[r];for(var i in o)o.hasOwnProperty(i)&&(e[i]=a(e[i],o[i]))}return e}},to=no(function(n,t){return C.isObject(n)&&C.isObject(t)?to(n,t):t}),eo=no(function(n,t){return t}),ro={deepMerge:to,merge:eo},oo=function(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t},io=function(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return R.none()},ao=function(n,t){return Z.rowcells(t,n.section())},uo=function(n,t){return n.cells()[t]},co=function(n,t,e){var r=n.cells(),o=r.slice(0,t),i=r.slice(t),a=o.concat([e]).concat(i);return ao(n,a)},lo=ao,so=function(n,t,e){n.cells()[t]=e},fo=uo,mo=function(n,t){return uo(n,t).element()},go=function(n,t){var e=n.cells(),r=E.map(e,t);return Z.rowcells(r,n.section())},po=function(n){return n.cells().length},ho=function(n,t){if(0===n.length)return 0;var e=n[0];return E.findIndex(n,function(n){return!t(e.element(),n.element())}).fold(function(){return n.length},function(n){return n})},vo=function(h,v){var b=E.map(h,function(n,t){return E.map(n.cells(),function(n,t){return!1})});return E.map(h,function(n,p){var t=E.bind(n.cells(),function(n,t){if(!1===b[p][t]){var e=(i=t,a=v,f=(u=r=h,c=o=p,u[c]).cells().slice(i),d=ho(f,a),m=(l=r,s=i,E.map(l,function(n){return fo(n,s)})).slice(o),g=ho(m,a),{colspan:x.constant(d),rowspan:x.constant(g)});return function(n,t,e,r){for(var o=n;o<n+e;o++)for(var i=t;i<t+r;i++)b[o][i]=!0}(p,t,e.rowspan(),e.colspan()),[Z.detailnew(n.element(),e.rowspan(),e.colspan(),n.isNew())]}var r,o,i,a,u,c,l,s,f,d,m,g;return[]});return Z.rowdetails(t,n.section())})},bo=function(n,t,e){for(var r=[],o=0;o<n.grid().rows();o++){for(var i=[],a=0;a<n.grid().columns();a++){var u=qt(n,o,a).map(function(n){return Z.elementnew(n.element(),e)}).getOrThunk(function(){return Z.elementnew(t.gap(),!0)});i.push(u)}var c=Z.rowcells(i,n.all()[o].section());r.push(c)}return r},wo=function(n,t,e,r){e===r?lt.remove(n,t):lt.set(n,t,e)},yo=function(n,t){for(var e=[],r=n;r<t;r++)e.push(r);return e},xo=function(t,e){if(e<0||e>=t.length-1)return R.none();var n=t[e].fold(function(){var n=E.reverse(t.slice(0,e));return io(n,function(n,t){return n.map(function(n){return{value:n,delta:t+1}})})},function(n){return R.some({value:n,delta:0})}),r=t[e+1].fold(function(){var n=t.slice(e+1);return io(n,function(n,t){return n.map(function(n){return{value:n,delta:t+1}})})},function(n){return R.some({value:n,delta:1})});return n.bind(function(e){return r.map(function(n){var t=n.delta+e.delta;return Math.abs(n.value-e.value)/t})})},Ro=function(n,t,e){var r=n();return E.find(r,t).orThunk(function(){return R.from(r[0]).orThunk(e)}).map(function(n){return n.element()})},Co=function(e){var n=e.grid(),t=yo(0,n.columns()),r=yo(0,n.rows());return E.map(t,function(t){return Ro(function(){return E.bind(r,function(n){return qt(e,n,t).filter(function(n){return n.column()===t}).fold(x.constant([]),function(n){return[n]})})},function(n){return 1===n.colspan()},function(){return qt(e,0,t)})})},So=function(e){var n=e.grid(),t=yo(0,n.rows()),r=yo(0,n.columns());return E.map(t,function(t){return Ro(function(){return E.bind(r,function(n){return qt(e,t,n).filter(function(n){return n.row()===t}).fold(x.constant([]),function(n){return[n]})})},function(n){return 1===n.rowspan()},function(){return qt(e,t,0)})})},To=function(n){var t=n.replace(/\./g,"-");return{resolve:function(n){return t+"-"+n}}},Do={resolve:To("ephox-snooker").resolve},ko=function(n,t){var e=lt.get(n,t);return void 0===e||""===e?[]:e.split(" ")},Oo=function(n,t){return o=t,i=ko(e=n,r="class").concat([o]),void lt.set(e,r,i.join(" "));var e,r,o,i},Ao=Oo,Po=function(n){return void 0!==n.dom().classList},No=function(n,t){return Po(n)&&n.dom().classList.contains(t)},Bo=function(n,t){Po(n)?n.dom().classList.add(t):Ao(n,t)},Eo=No,Io=Do.resolve("resizer-bar"),Wo=Do.resolve("resizer-rows"),Mo=Do.resolve("resizer-cols"),qo=function(n){var t=pt.descendants(n.parent(),"."+Io);E.each(t,Zt.remove)},jo=function(e,n,r){var o=e.origin();E.each(n,function(n,t){n.each(function(n){var t=r(o,n);Bo(t,Io),Jt.append(e.parent(),t)})})},zo=function(n,t,e,r,o,i){var a,u,l,s,c,f,d,m,g=Rr(t);a=n,u=0<e.length?o.positions(e,t):[],l=g,s=ur(t),jo(a,u,function(n,t){var e,r,o,i,a,u,c=(e=t.row(),r=l.left()-n.left(),o=t.y()-n.top(),i=s,a=7,u=y.fromTag("div"),Xt.setAll(u,{position:"absolute",left:r+"px",top:o-a/2+"px",height:a+"px",width:i+"px"}),lt.setAll(u,{"data-row":e,role:"presentation"}),u);return Bo(c,Wo),c}),c=n,f=0<r.length?i.positions(r,t):[],d=g,m=or(t),jo(c,f,function(n,t){var e,r,o,i,a,u,c=(e=t.col(),r=t.x()-n.left(),o=d.top()-n.top(),i=7,a=m,u=y.fromTag("div"),Xt.setAll(u,{position:"absolute",left:r-i/2+"px",top:o+"px",height:a+"px",width:i+"px"}),lt.setAll(u,{"data-column":e,role:"presentation"}),u);return Bo(c,Mo),c})},_o=function(n,t){var e=pt.descendants(n.parent(),"."+Io);E.each(e,t)},Lo=function(n,t,e,r){qo(n);var o=Et(t),i=Mt(o),a=So(i),u=Co(i);zo(n,t,a,u,e,r)},Fo=function(n){_o(n,function(n){Xt.set(n,"display","none")})},Ho=function(n){_o(n,function(n){Xt.set(n,"display","block")})},Vo=qo,Uo=function(n){return Eo(n,Wo)},Go=function(n){return Eo(n,Mo)},Xo=function(n,t){var e,r,o=vo(n,Ln.eq);return e=o,r=t,E.map(e,function(n){var t,e=(t=n.details(),io(t,function(n){return Kn.parent(n.element()).map(function(n){var t=Kn.parent(n).isNone();return Z.elementnew(n,t)})}).getOrThunk(function(){return Z.elementnew(r.row(),!0)}));return Z.rowdatanew(e.element(),n.details(),n.section(),e.isNew())})},Yo=function(n,t){var e=E.flatten(E.map(n.all(),function(n){return n.cells()}));return E.find(e,function(n){return Ln.eq(t,n.element())})},Ko=function(a,e,m,g,u){return function(s,f,n,o,d){var t=Et(f),i=Mt(t);return e(i,n).map(function(n){var t=bo(i,o,!1),e=a(t,n,Ln.eq,u(o)),r=Xo(e.grid(),o);return{grid:x.constant(r),cursor:e.cursor}}).fold(function(){return R.none()},function(n){var o,t,i,a,e,r,u,c,l=(o=f,t=n.grid(),i=[],a=[],e=function(n,t){0<n.length?function(n,t){var e=Dt.child(o,t).getOrThunk(function(){var n=y.fromTag(t,Kn.owner(o).dom());return Jt.append(o,n),n});Zt.empty(e);var r=E.map(n,function(n){n.isNew()&&i.push(n.element());var t=n.element();return Zt.empty(t),E.each(n.cells(),function(n){n.isNew()&&a.push(n.element()),wo(n.element(),"colspan",n.colspan(),1),wo(n.element(),"rowspan",n.rowspan(),1),Jt.append(t,n.element())}),t});$t.append(e,r)}(n,t):Dt.child(o,t).bind(Zt.remove)},r=[],u=[],c=[],E.each(t,function(n){switch(n.section()){case"thead":r.push(n);break;case"tbody":u.push(n);break;case"tfoot":c.push(n)}}),e(r,"thead"),e(u,"tbody"),e(c,"tfoot"),{newRows:x.constant(i),newCells:x.constant(a)});return m(f,n.grid(),d),g(f),Lo(s,f,Er.height,d),R.some({cursor:n.cursor,newRows:l.newRows,newCells:l.newCells})})}},Jo=Xo,$o=function(t,n){return At(n.element()).bind(function(n){return Yo(t,n)})},Qo=function(t,n){var e=E.map(n.selection(),function(n){return At(n).bind(function(n){return Yo(t,n)})}),r=oo(e);return 0<r.length?R.some(r):R.none()},Zo=function(t,n){var e=E.map(n.selection(),function(n){return At(n).bind(function(n){return Yo(t,n)})}),r=oo(e);return 0<r.length?R.some(ro.merge({cells:r},{generators:n.generators,clipboard:n.clipboard})):R.none()},ni=function(e){return{is:function(n){return e===n},isValue:x.always,isError:x.never,getOr:x.constant(e),getOrThunk:x.constant(e),getOrDie:x.constant(e),or:function(n){return ni(e)},orThunk:function(n){return ni(e)},fold:function(n,t){return t(e)},map:function(n){return ni(n(e))},each:function(n){n(e)},bind:function(n){return n(e)},exists:function(n){return n(e)},forall:function(n){return n(e)},toOption:function(){return R.some(e)}}},ti=function(e){return{is:x.never,isValue:x.never,isError:x.always,getOr:x.identity,getOrThunk:function(n){return n()},getOrDie:function(){return x.die(String(e))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,t){return n(e)},map:function(n){return ti(e)},each:x.noop,bind:function(n){return ti(e)},exists:x.never,forall:x.always,toOption:R.none}},ei={value:ni,error:ti},ri=function(n,t){return E.map(n,function(){return Z.elementnew(t.cell(),!0)})},oi=function(n,t,e){return E.map(n,function(n){return lo(n,n.cells().concat(ri(yo(0,t),e)))})},ii=function(n,t){var e=po(n[0]),r=po(t[0]);return{rowDelta:x.constant(0),colDelta:x.constant(e-r)}},ai=function(n,t,e){var r=t.colDelta()<0?oi:x.identity;return(t.rowDelta()<0?function(t,n,e){return t.concat(function(n,t){for(var e=[],r=0;r<n;r++)e.push(t(r));return e}(n,function(n){return lo(t[t.length-1],ri(t[t.length-1].cells(),e))}))}:x.identity)(r(n,Math.abs(t.colDelta()),e),Math.abs(t.rowDelta()),e)},ui=function(n,t,e,r){for(var o=!0,i=0;i<n.length;i++)for(var a=0;a<po(n[0]);a++){var u=e(mo(n[i],a),t);!0===u&&!1===o?so(n[i],a,Z.elementnew(r(),!0)):!0===u&&(o=!1)}return n},ci=function(e,r,o,i,a){return function(n,t,e){if(n.row()>=t.length||n.column()>po(t[0]))return ei.error("invalid start address out of table bounds, row: "+n.row()+", column: "+n.column());var r=t.slice(n.row()),o=r[0].cells().slice(n.column()),i=po(e[0]),a=e.length;return ei.value({rowDelta:x.constant(r.length-a),colDelta:x.constant(o.length-i)})}(e,r,o).map(function(n){var t=ai(r,n,i);return function(n,t,e,r,o){for(var i,a,u,c,l,s,f,d=n.row(),m=n.column(),g=d+e.length,p=m+po(e[0]),h=d;h<g;h++)for(var v=m;v<p;v++){u=v,c=o,s=l=void 0,l=fo((i=t)[a=h],u),s=x.curry(c,l.element()),f=i[a],1<i.length&&1<po(f)&&(0<u&&s(mo(f,u-1))||u<f.length-1&&s(mo(f,u+1))||0<a&&s(mo(i[a-1],u))||a<i.length-1&&s(mo(i[a+1],u)))&&ui(t,mo(t[h],v),o,r.cell);var b=mo(e[h-d],v-m),w=r.replace(b);so(t[h],v,Z.elementnew(w,!0))}return t}(e,t,o,i,a)})},li=function(n,t,e,r,o){!function(i,a,u,c){if(0<a&&a<i.length){var n=(t=i[a-1].cells(),e=u,E.foldl(t,function(n,t){return E.exists(n,function(n){return e(n.element(),t.element())})?n:n.concat([t])},[]));E.each(n,function(n){for(var t=R.none(),e=a;e<i.length;e++)for(var r=0;r<po(i[0]);r++){var o=i[e].cells()[r];u(o.element(),n.element())&&(t.isNone()&&(t=R.some(c())),t.each(function(n){so(i[e],r,Z.elementnew(n,!0))}))}})}var t,e}(t,n,o,r.cell);var i=ii(e,t),a=ai(e,i,r),u=ii(t,a),c=ai(t,u,r);return c.slice(0,n).concat(a).concat(c.slice(n,c.length))},si=function(e,r,n,o,i){var t=e.slice(0,r),a=e.slice(r),u=go(e[n],function(n,t){return 0<r&&r<e.length&&o(mo(e[r-1],t),mo(e[r],t))?fo(e[r],t):Z.elementnew(i(n.element(),o),!0)});return t.concat([u]).concat(a)},fi=function(n,e,r,o,i){return E.map(n,function(n){var t=0<e&&e<po(n)&&o(mo(n,e-1),mo(n,e))?fo(n,e):Z.elementnew(i(mo(n,r),o),!0);return co(n,e,t)})},di=function(n,e,r,o){return E.map(n,function(n){return go(n,function(n){return t=n,E.exists(e,function(n){return r(t.element(),n.element())})?Z.elementnew(o(n.element(),r),!0):n;var t})})},mi=function(n,t,e,r){return void 0!==mo(n[t],e)&&0<t&&r(mo(n[t-1],e),mo(n[t],e))},gi=function(n,t,e){return 0<t&&e(mo(n,t-1),mo(n,t))},pi=function(e,r,o,n){var t=E.bind(e,function(n,t){return mi(e,t,r,o)||gi(n,r,o)?[]:[fo(n,r)]});return di(e,t,o,n)},hi=function(e,r,o,n){var i=e[r],t=E.bind(i.cells(),function(n,t){return mi(e,r,t,o)||gi(i,t,o)?[]:[n]});return di(e,t,o,n)},vi=function(n){return{fold:n}},bi=function(){return vi(function(n,t,e,r,o){return n()})},wi=function(n,t,i,a){var e,r,u,c,l,s,f,d,m,g,p=n.slice(0),o=(r=t,0===(e=n).length?bi():1===e.length?(g=0,vi(function(n,t,e,r,o){return t(g)})):0===r?(d=0,m=1,vi(function(n,t,e,r,o){return e(d,m)})):r===e.length-1?(s=r-1,f=r,vi(function(n,t,e,r,o){return o(s,f)})):0<r&&r<e.length-1?(u=r-1,l=(c=r)+1,vi(function(n,t,e,r,o){return r(u,c,l)})):bi()),h=function(n){return E.map(n,x.constant(0))},v=x.constant(h(p)),b=function(n,t){if(0<=i){var e=Math.max(a.minCellWidth(),p[t]-i);return h(p.slice(0,n)).concat([i,e-p[t]]).concat(h(p.slice(t+1)))}var r=Math.max(a.minCellWidth(),p[n]+i),o=p[n]-r;return h(p.slice(0,n)).concat([r-p[n],o]).concat(h(p.slice(t+1)))},w=b;return o.fold(v,function(n){return a.singleColumnWidth(p[n],i)},w,function(n,t,e){return b(t,e)},function(n,t){if(0<=i)return h(p.slice(0,t)).concat([i]);var e=Math.max(a.minCellWidth(),p[t]+i);return h(p.slice(0,t)).concat([e-p[t]])})},yi=function(n,t){return lt.has(n,t)&&1<parseInt(lt.get(n,t),10)},xi={hasColspan:function(n){return yi(n,"colspan")},hasRowspan:function(n){return yi(n,"rowspan")},minWidth:x.constant(10),minHeight:x.constant(10),getInt:function(n,t){return parseInt(Xt.get(n,t),10)}},Ri=function(n,t,e){return Xt.getRaw(n,t).fold(function(){return e(n)+"px"},function(n){return n})},Ci=function(n){return Ri(n,"width",vr.getPixelWidth)},Si=function(n){return Ri(n,"height",vr.getHeight)},Ti=function(n,t,e,r,o){var i=Co(n),a=E.map(i,function(n){return n.map(t.edge)});return E.map(i,function(n,t){return n.filter(x.not(xi.hasColspan)).fold(function(){var n=xo(a,t);return r(n)},function(n){return e(n,o)})})},Di=function(n){return n.map(function(n){return n+"px"}).getOr("")},ki=function(n,t,e,r){var o=So(n),i=E.map(o,function(n){return n.map(t.edge)});return E.map(o,function(n,t){return n.filter(x.not(xi.hasRowspan)).fold(function(){var n=xo(i,t);return r(n)},function(n){return e(n)})})},Oi={getRawWidths:function(n,t){return Ti(n,t,Ci,Di)},getPixelWidths:function(n,t,e){return Ti(n,t,vr.getPixelWidth,function(n){return n.getOrThunk(e.minCellWidth)},e)},getPercentageWidths:function(n,t,e){return Ti(n,t,vr.getPercentageWidth,function(n){return n.fold(function(){return e.minCellWidth()},function(n){return n/e.pixelWidth()*100})},e)},getPixelHeights:function(n,t){return ki(n,t,vr.getHeight,function(n){return n.getOrThunk(xi.minHeight)})},getRawHeights:function(n,t){return ki(n,t,Si,Di)}},Ai=function(n,t,e){for(var r=0,o=n;o<t;o++)r+=void 0!==e[o]?e[o]:0;return r},Pi=function(n,e){var t=_t(n);return E.map(t,function(n){var t=Ai(n.column(),n.column()+n.colspan(),e);return{element:n.element,width:x.constant(t),colspan:n.colspan}})},Ni=function(n){var t=parseInt(n,10),e=x.identity;return{width:x.constant(t),pixelWidth:x.constant(t),getWidths:Oi.getPixelWidths,getCellDelta:e,singleColumnWidth:function(n,t){return[Math.max(xi.minWidth(),n+t)-n]},minCellWidth:xi.minWidth,setElementWidth:vr.setPixelWidth,setTableWidth:function(n,t,e){var r=E.foldr(t,function(n,t){return n+t},0);vr.setPixelWidth(n,r)}}},Bi=function(t){return vr.getRawWidth(t).fold(function(){var n=ar(t);return Ni(n)},function(n){return function(n,t){if(vr.percentageBasedSizeRegex().test(t))return r=vr.percentageBasedSizeRegex().exec(t)[1],o=n,i=parseFloat(r),a=ar(o),{width:x.constant(i),pixelWidth:x.constant(a),getWidths:Oi.getPercentageWidths,getCellDelta:function(n){return n/a*100},singleColumnWidth:function(n,t){return[100-n]},minCellWidth:function(){return xi.minWidth()/a*100},setElementWidth:vr.setPercentageWidth,setTableWidth:function(n,t,e){var r=i+e;vr.setPercentageWidth(n,r)}};if(vr.pixelBasedSizeRegex().test(t)){var e=vr.pixelBasedSizeRegex().exec(t);return Ni(e[1])}var r,o,i,a,u=ar(n);return Ni(u)}(t,n)})},Ei=function(n){return Mt(n)},Ii=function(n){var t=Et(n);return Ei(t)},Wi=function(n,t,e,r){var o=Bi(n),i=o.getCellDelta(t),a=Ii(n),u=o.getWidths(a,r,o),c=wi(u,e,i,o),l=E.map(c,function(n,t){return n+u[t]}),s=Pi(a,l);E.each(s,function(n){o.setElementWidth(n.element(),n.width())}),e===a.grid().columns()-1&&o.setTableWidth(n,l,i)},Mi=function(n,e,r,t){var o,i,a,u,c=Ii(n),l=Oi.getPixelHeights(c,t),s=E.map(l,function(n,t){return r===t?Math.max(e+n,xi.minHeight()):n}),f=(a=s,u=_t(c),E.map(u,function(n){var t=Ai(n.row(),n.row()+n.rowspan(),a);return{element:n.element,height:x.constant(t),rowspan:n.rowspan}})),d=(o=c,i=s,E.map(o.all(),function(n,t){return{element:n.element,height:x.constant(i[t])}}));E.each(d,function(n){vr.setHeight(n.element(),n.height())}),E.each(f,function(n){vr.setHeight(n.element(),n.height())});var m,g=(m=s,E.foldr(m,function(n,t){return n+t},0));vr.setHeight(n,g)},qi=function(n,t,e){var r=Bi(n),o=Ei(t),i=r.getWidths(o,e,r),a=Pi(o,i);E.each(a,function(n){r.setElementWidth(n.element(),n.width())});var u=E.foldr(i,function(n,t){return t+n},0);0<a.length&&r.setElementWidth(n,u)},ji=function(n){0===Pt(n).length&&Zt.remove(n)},zi=G.immutable("grid","cursor"),_i=function(n,t,e){return Li(n,t,e).orThunk(function(){return Li(n,0,0)})},Li=function(n,t,e){return R.from(n[t]).bind(function(n){return R.from(n.cells()[e]).bind(function(n){return R.from(n.element())})})},Fi=function(n,t,e){return zi(n,Li(n,t,e))},Hi=function(n){return E.foldl(n,function(n,t){return E.exists(n,function(n){return n.row()===t.row()})?n:n.concat([t])},[]).sort(function(n,t){return n.row()-t.row()})},Vi=function(n){return E.foldl(n,function(n,t){return E.exists(n,function(n){return n.column()===t.column()})?n:n.concat([t])},[]).sort(function(n,t){return n.column()-t.column()})},Ui=function(n,t,e){var r,o,i=(r=n,o=e,E.map(r,function(n){var t=E.map(Pt(n),function(n){var t=lt.has(n,"rowspan")?parseInt(lt.get(n,"rowspan"),10):1,e=lt.has(n,"colspan")?parseInt(lt.get(n,"colspan"),10):1;return Z.detail(n,t,e)});return Z.rowdata(n,t,o.section())})),a=Mt(i);return bo(a,t,!0)},Gi=qi,Xi={insertRowBefore:Ko(function(n,t,e,r){var o=t.row(),i=t.row(),a=si(n,i,o,e,r.getOrInit);return Fi(a,i,t.column())},$o,x.noop,x.noop,Vr),insertRowsBefore:Ko(function(n,t,e,r){var o=t[0].row(),i=t[0].row(),a=Hi(t),u=E.foldl(a,function(n,t){return si(n,i,o,e,r.getOrInit)},n);return Fi(u,i,t[0].column())},Qo,x.noop,x.noop,Vr),insertRowAfter:Ko(function(n,t,e,r){var o=t.row(),i=t.row()+t.rowspan(),a=si(n,i,o,e,r.getOrInit);return Fi(a,i,t.column())},$o,x.noop,x.noop,Vr),insertRowsAfter:Ko(function(n,t,e,r){var o=Hi(t),i=o[o.length-1].row(),a=o[o.length-1].row()+o[o.length-1].rowspan(),u=E.foldl(o,function(n,t){return si(n,a,i,e,r.getOrInit)},n);return Fi(u,a,t[0].column())},Qo,x.noop,x.noop,Vr),insertColumnBefore:Ko(function(n,t,e,r){var o=t.column(),i=t.column(),a=fi(n,i,o,e,r.getOrInit);return Fi(a,t.row(),i)},$o,Gi,x.noop,Vr),insertColumnsBefore:Ko(function(n,t,e,r){var o=Vi(t),i=o[0].column(),a=o[0].column(),u=E.foldl(o,function(n,t){return fi(n,a,i,e,r.getOrInit)},n);return Fi(u,t[0].row(),a)},Qo,Gi,x.noop,Vr),insertColumnAfter:Ko(function(n,t,e,r){var o=t.column(),i=t.column()+t.colspan(),a=fi(n,i,o,e,r.getOrInit);return Fi(a,t.row(),i)},$o,Gi,x.noop,Vr),insertColumnsAfter:Ko(function(n,t,e,r){var o=t[t.length-1].column(),i=t[t.length-1].column()+t[t.length-1].colspan(),a=Vi(t),u=E.foldl(a,function(n,t){return fi(n,i,o,e,r.getOrInit)},n);return Fi(u,t[0].row(),i)},Qo,Gi,x.noop,Vr),splitCellIntoColumns:Ko(function(n,t,e,r){var o,i,a,u,c,l,s=(o=n,i=t.row(),a=t.column(),u=e,c=r.getOrInit,l=a+1,E.map(o,function(n,t){var e=t===i?Z.elementnew(c(mo(n,a),u),!0):fo(n,a);return co(n,l,e)}));return Fi(s,t.row(),t.column())},$o,Gi,x.noop,Vr),splitCellIntoRows:Ko(function(n,t,e,r){var o,i,a,u,c,l,s,f,d,m=(o=n,i=t.row(),a=t.column(),u=e,c=r.getOrInit,l=i+1,s=o.slice(0,l),f=o.slice(l),d=go(o[i],function(n,t){return t===a?Z.elementnew(c(n.element(),u),!0):n}),s.concat([d]).concat(f));return Fi(m,t.row(),t.column())},$o,x.noop,x.noop,Vr),eraseColumns:Ko(function(n,t,e,r){var o,i,a,u,c=Vi(t),l=(o=n,i=c[0].column(),a=c[c.length-1].column(),u=E.map(o,function(n){var t=n.cells().slice(0,i).concat(n.cells().slice(a+1));return Z.rowcells(t,n.section())}),E.filter(u,function(n){return 0<n.cells().length})),s=_i(l,t[0].row(),t[0].column());return zi(l,s)},Qo,Gi,ji,Vr),eraseRows:Ko(function(n,t,e,r){var o,i,a,u=Hi(t),c=(o=n,i=u[0].row(),a=u[u.length-1].row(),o.slice(0,i).concat(o.slice(a+1))),l=_i(c,t[0].row(),t[0].column());return zi(c,l)},Qo,x.noop,ji,Vr),makeColumnHeader:Ko(function(n,t,e,r){var o=pi(n,t.column(),e,r.replaceOrInit);return Fi(o,t.row(),t.column())},$o,x.noop,x.noop,Ur("row","th")),unmakeColumnHeader:Ko(function(n,t,e,r){var o=pi(n,t.column(),e,r.replaceOrInit);return Fi(o,t.row(),t.column())},$o,x.noop,x.noop,Ur(null,"td")),makeRowHeader:Ko(function(n,t,e,r){var o=hi(n,t.row(),e,r.replaceOrInit);return Fi(o,t.row(),t.column())},$o,x.noop,x.noop,Ur("col","th")),unmakeRowHeader:Ko(function(n,t,e,r){var o=hi(n,t.row(),e,r.replaceOrInit);return Fi(o,t.row(),t.column())},$o,x.noop,x.noop,Ur(null,"td")),mergeCells:Ko(function(n,t,e,r){var o=t.cells();Zr(o);var i=function(n,t,e,r){if(0===n.length)return n;for(var o=t.startRow();o<=t.finishRow();o++)for(var i=t.startCol();i<=t.finishCol();i++)so(n[o],i,Z.elementnew(r(),!1));return n}(n,t.bounds(),0,x.constant(o[0]));return zi(i,R.from(o[0]))},function(n,t){return t.mergable()},x.noop,x.noop,Gr),unmergeCells:Ko(function(n,t,e,r){var o=E.foldr(t,function(n,t){return ui(n,t,e,r.combine(t))},n);return zi(o,R.from(t[0]))},function(n,t){return t.unmergable()},Gi,x.noop,Gr),pasteCells:Ko(function(n,e,t,r){var o,i,a,u,c=(o=e.clipboard(),i=e.generators(),a=Et(o),u=Mt(a),bo(u,i,!0)),l=Z.address(e.row(),e.column());return ci(l,n,c,e.generators(),t).fold(function(){return zi(n,R.some(e.element()))},function(n){var t=_i(n,e.row(),e.column());return zi(n,t)})},function(t,e){return At(e.element()).bind(function(n){return Yo(t,n).map(function(n){return ro.merge(n,{generators:e.generators,clipboard:e.clipboard})})})},Gi,x.noop,Vr),pasteRowsBefore:Ko(function(n,t,e,r){var o=n[t.cells[0].row()],i=t.cells[0].row(),a=Ui(t.clipboard(),t.generators(),o),u=li(i,n,a,t.generators(),e),c=_i(u,t.cells[0].row(),t.cells[0].column());return zi(u,c)},Zo,x.noop,x.noop,Vr),pasteRowsAfter:Ko(function(n,t,e,r){var o=n[t.cells[0].row()],i=t.cells[t.cells.length-1].row()+t.cells[t.cells.length-1].rowspan(),a=Ui(t.clipboard(),t.generators(),o),u=li(i,n,a,t.generators(),e),c=_i(u,t.cells[0].row(),t.cells[0].column());return zi(u,c)},Zo,x.noop,x.noop,Vr)},Yi=function(n){return y.fromDom(n.getBody())},Ki=function(n){return n.getBoundingClientRect().width},Ji=function(n){return n.getBoundingClientRect().height},$i=function(t){return function(n){return Ln.eq(n,Yi(t))}},Qi=function(n){return/^[0-9]+$/.test(n)&&(n+="px"),n},Zi=function(n){return"rtl"===Xt.get(n,"direction")?"rtl":"ltr"},na=Zi,ta={isRtl:x.constant(!1)},ea={isRtl:x.constant(!0)},ra=function(n){return"rtl"===na(n)?ea:ta},oa=["tableprops","tabledelete","|","tableinsertrowbefore","tableinsertrowafter","tabledeleterow","|","tableinsertcolbefore","tableinsertcolafter","tabledeletecol"],ia={"border-collapse":"collapse",width:"100%"},aa={border:"1"},ua=function(n){return n.getParam("table_cell_advtab",!0,"boolean")},ca=function(n){return n.getParam("table_row_advtab",!0,"boolean")},la=function(n){return n.getParam("table_advtab",!0,"boolean")},sa=function(n){return n.getParam("table_style_by_css",!1,"boolean")},fa=function(n){return n.getParam("table_cell_class_list",[],"array")},da=function(n){return n.getParam("table_row_class_list",[],"array")},ma=function(n){return n.getParam("table_class_list",[],"array")},ga=function(n){return!1===n.getParam("table_responsive_width")},pa=function(n,t){return n.fire("newrow",{node:t})},ha=function(n,t){return n.fire("newcell",{node:t})},va=function(n,t,e,r){n.fire("ObjectResizeStart",{target:t,width:e,height:r})},ba=function(n,t,e,r){n.fire("ObjectResized",{target:t,width:e,height:r})},wa=function(n,t,o){var e=Et(n),i=Mt(e);return Qo(i,t).map(function(n){var t,e=bo(i,o,!1).slice(n[0].row(),n[n.length-1].row()+n[n.length-1].rowspan()),r=Jo(e,o);return t=r,E.map(t,function(n){var e=re(n.element());return E.each(n.cells(),function(n){var t=oe(n.element());wo(t,"colspan",n.colspan(),1),wo(t,"rowspan",n.rowspan(),1),Jt.append(e,t)}),e})})},ya=tinymce.util.Tools.resolve("tinymce.util.Tools"),xa=function(n,t,e){e&&n.formatter.apply("align"+e,{},t)},Ra=function(n,t,e){e&&n.formatter.apply("valign"+e,{},t)},Ca=function(t,e){ya.each("left center right".split(" "),function(n){t.formatter.remove("align"+n,{},e)})},Sa=function(t,e){ya.each("top middle bottom".split(" "),function(n){t.formatter.remove("valign"+n,{},e)})},Ta=function(o,n,i){var t;return function(n,t){for(var e=0;e<t.length;e++){var r=o.getStyle(t[e],i);if(void 0===n&&(n=r),n!==r)return""}return n}(t,o.select("td,th",n))},Da=function(n,t){var e=n.dom,r=t.control.rootControl,o=r.toJSON(),i=e.parseStyle(o.style);"style"===t.control.name()?(r.find("#borderStyle").value(i["border-style"]||"")[0].fire("select"),r.find("#borderColor").value(i["border-color"]||"")[0].fire("change"),r.find("#backgroundColor").value(i["background-color"]||"")[0].fire("change"),r.find("#width").value(i.width||"").fire("change"),r.find("#height").value(i.height||"").fire("change")):(i["border-style"]=o.borderStyle,i["border-color"]=o.borderColor,i["background-color"]=o.backgroundColor,i.width=o.width?Qi(o.width):"",i.height=o.height?Qi(o.height):""),r.find("#style").value(e.serializeStyle(e.parseStyle(e.serializeStyle(i))))},ka=function(e){var n=function(){var n=e.getParam("color_picker_callback");if(n)return function(t){return n.call(e,function(n){t.control.value(n).fire("change")},t.control.value())}};return{title:"Advanced",type:"form",defaults:{onchange:x.curry(Da,e)},items:[{label:"Style",name:"style",type:"textbox"},{type:"form",padding:0,formItemDefaults:{layout:"grid",alignH:["start","right"]},defaults:{size:7},items:[{label:"Border style",type:"listbox",name:"borderStyle",width:90,onselect:x.curry(Da,e),values:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]},{label:"Border color",type:"colorbox",name:"borderColor",onaction:n()},{label:"Background color",type:"colorbox",name:"backgroundColor",onaction:n()}]}]}},Oa=function(n,r,t){var o=function(n,e){return e=e||[],ya.each(n,function(n){var t={text:n.text||n.title};n.menu?t.menu=o(n.menu):(t.value=n.value,r&&r(t)),e.push(t)}),e};return o(n,t||[])},Aa=Da,Pa=function(n,t){var e=n.parseStyle(n.getAttrib(t,"style")),r={};return e["border-style"]&&(r.borderStyle=e["border-style"]),e["border-color"]&&(r.borderColor=e["border-color"]),e["background-color"]&&(r.backgroundColor=e["background-color"]),r.style=n.serializeStyle(e),r},Na=function(r,o,n){var i,a=r.dom;function u(n,t,e){e&&a.setAttrib(n,t,e)}function c(n,t,e){e&&a.setStyle(n,t,e)}Aa(r,n),i=n.control.rootControl.toJSON(),r.undoManager.transact(function(){ya.each(o,function(n){var t,e;u(n,"scope",i.scope),1===o.length?u(n,"style",i.style):(t=n,e=i.style,delete t.dataset.mceStyle,t.style.cssText+=";"+e),u(n,"class",i.class),c(n,"width",Qi(i.width)),c(n,"height",Qi(i.height)),i.type&&n.nodeName.toLowerCase()!==i.type&&(n=a.rename(n,i.type)),1===o.length&&(Ca(r,n),Sa(r,n)),i.align&&xa(r,n,i.align),i.valign&&Ra(r,n,i.valign)}),r.focus()})},Ba=function(t){var n,e,r,o=[];if(o=t.dom.select("td[data-mce-selected],th[data-mce-selected]"),n=t.dom.getParent(t.selection.getStart(),"td,th"),!o.length&&n&&o.push(n),n=n||o[0]){var i,a,u,c;1<o.length?e={width:"",height:"",scope:"",class:"",align:"",valign:"",style:"",type:n.nodeName.toLowerCase()}:(a=n,u=(i=t).dom,c={width:u.getStyle(a,"width")||u.getAttrib(a,"width"),height:u.getStyle(a,"height")||u.getAttrib(a,"height"),scope:u.getAttrib(a,"scope"),class:u.getAttrib(a,"class"),type:a.nodeName.toLowerCase(),style:"",align:"",valign:""},ya.each("left center right".split(" "),function(n){i.formatter.matchNode(a,"align"+n)&&(c.align=n)}),ya.each("top middle bottom".split(" "),function(n){i.formatter.matchNode(a,"valign"+n)&&(c.valign=n)}),ua(i)&&ya.extend(c,Pa(u,a)),e=c),0<fa(t).length&&(r={name:"class",type:"listbox",label:"Class",values:Oa(fa(t),function(n){n.value&&(n.textStyle=function(){return t.formatter.getCssText({block:"td",classes:[n.value]})})})});var l={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,items:[{type:"form",layout:"grid",columns:2,labelGapCalc:!1,padding:0,defaults:{type:"textbox",maxWidth:50},items:[{label:"Cell type",name:"type",type:"listbox",text:"None",minWidth:180,maxWidth:null,values:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]}]},r]};ua(t)?t.windowManager.open({title:"Cell properties",bodyType:"tabpanel",data:e,body:[{title:"General",type:"form",items:l},ka(t)],onsubmit:x.curry(Na,t,o)}):t.windowManager.open({title:"Cell properties",data:e,body:l,onsubmit:x.curry(Na,t,o)})}};function Ea(l,n,s,t){var f=l.dom;function d(n,t,e){e&&f.setAttrib(n,t,e)}Aa(l,t);var m=t.control.rootControl.toJSON();l.undoManager.transact(function(){ya.each(n,function(n){var t,e,r,o,i,a,u,c;d(n,"scope",m.scope),d(n,"style",m.style),d(n,"class",m.class),t=n,(e=Qi(m.height))&&f.setStyle(t,"height",e),m.type!==n.parentNode.nodeName.toLowerCase()&&(r=l.dom,o=n,i=m.type,a=r.getParent(o,"table"),u=o.parentNode,(c=r.select(i,a)[0])||(c=r.create(i),a.firstChild?"CAPTION"===a.firstChild.nodeName?r.insertAfter(c,a.firstChild):a.insertBefore(c,a.firstChild):a.appendChild(c)),c.appendChild(o),u.hasChildNodes()||r.remove(u)),m.align!==s.align&&(Ca(l,n),xa(l,n,m.align))}),l.focus()})}var Ia=function(t){var n,e,r,o,i,a,u,c,l,s,f=t.dom,d=[];n=f.getParent(t.selection.getStart(),"table"),e=f.getParent(t.selection.getStart(),"td,th"),ya.each(n.rows,function(t){ya.each(t.cells,function(n){if(f.getAttrib(n,"data-mce-selected")||n===e)return d.push(t),!1})}),(r=d[0])&&(1<d.length?i={height:"",scope:"",style:"",class:"",align:"",type:r.parentNode.nodeName.toLowerCase()}:(c=r,l=(u=t).dom,s={height:l.getStyle(c,"height")||l.getAttrib(c,"height"),scope:l.getAttrib(c,"scope"),class:l.getAttrib(c,"class"),align:"",style:"",type:c.parentNode.nodeName.toLowerCase()},ya.each("left center right".split(" "),function(n){u.formatter.matchNode(c,"align"+n)&&(s.align=n)}),ca(u)&&ya.extend(s,Pa(l,c)),i=s),0<da(t).length&&(o={name:"class",type:"listbox",label:"Class",values:Oa(da(t),function(n){n.value&&(n.textStyle=function(){return t.formatter.getCssText({block:"tr",classes:[n.value]})})})}),a={type:"form",columns:2,padding:0,defaults:{type:"textbox"},items:[{type:"listbox",name:"type",label:"Row type",text:"Header",maxWidth:null,minWidth:180,values:[{text:"Header",value:"thead"},{text:"Body",value:"tbody"},{text:"Footer",value:"tfoot"}]},o]},ca(t)?t.windowManager.open({title:"Row properties",data:i,bodyType:"tabpanel",body:[{title:"General",type:"form",items:a},ka(t)],onsubmit:x.curry(Ea,t,d,i)}):t.windowManager.open({title:"Row properties",data:i,body:a,onsubmit:x.curry(Ea,t,d,i)}))},Wa=tinymce.util.Tools.resolve("tinymce.Env"),Ma={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"},percentages:!0},qa=function(n,t){n.selection.select(t.dom(),!0),n.selection.collapse(!0)},ja=function(o,n,t){var e,r,i=o.getParam("table_default_styles",ia,"object"),a=function(n,t,e,r,o){void 0===o&&(o=Ma);var i=y.fromTag("table");Xt.setAll(i,o.styles),lt.setAll(i,o.attributes);var a=y.fromTag("tbody");Jt.append(i,a);for(var u=[],c=0;c<n;c++){for(var l=y.fromTag("tr"),s=0;s<t;s++){var f=y.fromTag(c<e||s<r?"th":"td");s<r&&lt.set(f,"scope","row"),c<e&&lt.set(f,"scope","col"),Jt.append(f,y.fromTag("br")),o.percentages&&Xt.set(f,"width",100/t+"%"),Jt.append(l,f)}u.push(l)}return $t.append(a,u),i}(t,n,0,0,{styles:i,attributes:(r=o,r.getParam("table_default_attributes",aa,"object")),percentages:(e=i.width,C.isString(e)&&-1!==e.indexOf("%")&&!ga(o))});lt.set(a,"data-mce-id","__mce");var u,c,l,s=(u=a,c=y.fromTag("div"),l=y.fromDom(u.dom().cloneNode(!0)),Jt.append(c,l),c.dom().innerHTML);return o.insertContent(s),Dt.descendant(Yi(o),'table[data-mce-id="__mce"]').map(function(n){var t,e,r;return ga(o)&&Xt.set(n,"width",Xt.get(n,"width")),lt.remove(n,"data-mce-id"),t=o,e=n,E.each(pt.descendants(e,"tr"),function(n){pa(t,n.dom()),E.each(pt.descendants(n,"th,td"),function(n){ha(t,n.dom())})}),r=o,Dt.descendant(n,"td,th").each(x.curry(qa,r)),n.dom()}).getOr(null)};function za(n,t,e,r){if("TD"===t.tagName||"TH"===t.tagName)n.setStyle(t,e,r);else if(t.children)for(var o=0;o<t.children.length;o++)za(n,t.children[o],e,r)}var _a=function(n,t,e){var r,o,i=n.dom;Aa(n,e),!1===(o=e.control.rootControl.toJSON()).class&&delete o.class,n.undoManager.transact(function(){t||(t=ja(n,o.cols||1,o.rows||1)),function(n,t,e){var r,o=n.dom,i={},a={};if(i.class=e.class,a.height=Qi(e.height),o.getAttrib(t,"width")&&!sa(n)?i.width=(r=e.width)?r.replace(/px$/,""):"":a.width=Qi(e.width),sa(n)?(a["border-width"]=Qi(e.border),a["border-spacing"]=Qi(e.cellspacing),ya.extend(i,{"data-mce-border-color":e.borderColor,"data-mce-cell-padding":e.cellpadding,"data-mce-border":e.border})):ya.extend(i,{border:e.border,cellpadding:e.cellpadding,cellspacing:e.cellspacing}),sa(n)&&t.children)for(var u=0;u<t.children.length;u++)za(o,t.children[u],{"border-width":Qi(e.border),"border-color":e.borderColor,padding:Qi(e.cellpadding)});e.style?ya.extend(a,o.parseStyle(e.style)):a=ya.extend({},o.parseStyle(o.getAttrib(t,"style")),a),i.style=o.serializeStyle(a),o.setAttribs(t,i)}(n,t,o),(r=i.select("caption",t)[0])&&!o.caption&&i.remove(r),!r&&o.caption&&((r=i.create("caption")).innerHTML=Wa.ie?" ":'<br data-mce-bogus="1"/>',t.insertBefore(r,t.firstChild)),Ca(n,t),o.align&&xa(n,t,o.align),n.focus(),n.addVisual()})},La=function(t,n){var e,r,o,i,a,u,c,l,s,f,d=t.dom,m={};!0===n?(e=d.getParent(t.selection.getStart(),"table"))&&(c=e,l=(u=t).dom,s={width:l.getStyle(c,"width")||l.getAttrib(c,"width"),height:l.getStyle(c,"height")||l.getAttrib(c,"height"),cellspacing:l.getStyle(c,"border-spacing")||l.getAttrib(c,"cellspacing"),cellpadding:l.getAttrib(c,"data-mce-cell-padding")||l.getAttrib(c,"cellpadding")||Ta(u.dom,c,"padding"),border:l.getAttrib(c,"data-mce-border")||l.getAttrib(c,"border")||Ta(u.dom,c,"border"),borderColor:l.getAttrib(c,"data-mce-border-color"),caption:!!l.select("caption",c)[0],class:l.getAttrib(c,"class")},ya.each("left center right".split(" "),function(n){u.formatter.matchNode(c,"align"+n)&&(s.align=n)}),la(u)&&ya.extend(s,Pa(l,c)),m=s):(r={label:"Cols",name:"cols"},o={label:"Rows",name:"rows"}),0<ma(t).length&&(m.class&&(m.class=m.class.replace(/\s*mce\-item\-table\s*/g,"")),i={name:"class",type:"listbox",label:"Class",values:Oa(ma(t),function(n){n.value&&(n.textStyle=function(){return t.formatter.getCssText({block:"table",classes:[n.value]})})})}),a={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,minWidth:300,items:[{type:"form",labelGapCalc:!1,padding:0,layout:"grid",columns:2,defaults:{type:"textbox",maxWidth:50},items:(f=t,f.getParam("table_appearance_options",!0,"boolean")?[r,o,{label:"Caption",name:"caption",type:"checkbox"}]:[r,o,{label:"Width",name:"width",onchange:x.curry(Aa,t)},{label:"Height",name:"height",onchange:x.curry(Aa,t)}])},i]},la(t)?t.windowManager.open({title:"Table properties",data:m,bodyType:"tabpanel",body:[{title:"General",type:"form",items:a},ka(t)],onsubmit:x.curry(_a,t,e)}):t.windowManager.open({title:"Table properties",data:m,body:a,onsubmit:x.curry(_a,t,e)})},Fa=ya.each,Ha=function(u,t,c,l,e){var r=$i(u),s=function(){return y.fromDom(u.dom.getParent(u.selection.getStart(),"th,td"))},f=function(n){return Nt(n,r)},d=function(n){return{width:Ki(n.dom()),height:Ki(n.dom())}},o=function(t){var e=s();f(e).each(function(i){var n=Ze.forMenu(l,i,e),a=d(i);t(i,n).each(function(n){var t,e,r,o;t=u,e=a,o=d(r=i),e.width===o.width&&e.height===o.height||(va(t,r.dom(),e.width,e.height),ba(t,r.dom(),o.width,o.height)),u.selection.setRng(n),u.focus(),c.clear(i)})})},i=function(n){var o=s();return f(o).bind(function(n){var t=y.fromDom(u.getDoc()),e=Ze.forMenu(l,n,o),r=ve(x.noop,t,R.none());return wa(n,e,r)})},a=function(a){e.get().each(function(n){var o=E.map(n,function(n){return oe(n)}),i=s();f(i).bind(function(t){var n=y.fromDom(u.getDoc()),e=be(n),r=Ze.pasteRows(l,t,i,o,e);a(t,r).each(function(n){u.selection.setRng(n),u.focus(),c.clear(t)})})})};Fa({mceTableSplitCells:function(){o(t.unmergeCells)},mceTableMergeCells:function(){o(t.mergeCells)},mceTableInsertRowBefore:function(){o(t.insertRowsBefore)},mceTableInsertRowAfter:function(){o(t.insertRowsAfter)},mceTableInsertColBefore:function(){o(t.insertColumnsBefore)},mceTableInsertColAfter:function(){o(t.insertColumnsAfter)},mceTableDeleteCol:function(){o(t.deleteColumn)},mceTableDeleteRow:function(){o(t.deleteRow)},mceTableCutRow:function(n){e.set(i()),o(t.deleteRow)},mceTableCopyRow:function(n){e.set(i())},mceTablePasteRowBefore:function(n){a(t.pasteRowsBefore)},mceTablePasteRowAfter:function(n){a(t.pasteRowsAfter)},mceTableDelete:function(){var n=y.fromDom(u.dom.getParent(u.selection.getStart(),"th,td"));Nt(n,r).filter(x.not(r)).each(function(n){var t=y.fromText("");Jt.after(n,t),Zt.remove(n);var e=u.dom.createRng();e.setStart(t.dom(),0),e.setEnd(t.dom(),0),u.selection.setRng(e)})}},function(n,t){u.addCommand(t,n)}),Fa({mceInsertTable:x.curry(La,u),mceTableProps:x.curry(La,u,!0),mceTableRowProps:x.curry(Ia,u),mceTableCellProps:x.curry(Ba,u)},function(e,n){u.addCommand(n,function(n,t){e(t)})})},Va=function(n){var t=R.from(n.dom().documentElement).map(y.fromDom).getOr(n);return{parent:x.constant(t),view:x.constant(n),origin:x.constant(wr(0,0))}};function Ua(n){var e=G.immutable.apply(null,n),r=[];return{bind:function(n){if(void 0===n)throw"Event bind error: undefined handler";r.push(n)},unbind:function(t){r=E.filter(r,function(n){return n!==t})},trigger:function(){var t=e.apply(null,arguments);E.each(r,function(n){n(t)})}}}var Ga={create:function(n){return{registry:z.map(n,function(n){return{bind:n.bind,unbind:n.unbind}}),trigger:z.map(n,function(n){return n.trigger})}}},Xa={mode:Lr.exactly(["compare","extract","mutate","sink"]),sink:Lr.exactly(["element","start","stop","destroy"]),api:Lr.exactly(["forceDrop","drop","move","delayDrop"])},Ya={resolve:To("ephox-dragster").resolve},Ka=function(n,t,e,r,o){var m,g,i=(m=e,g=r,function(n){if(m(n)){var t,e,r,o,i,a,u,c=y.fromDom(n.target),l=function(){n.stopPropagation()},s=function(){n.preventDefault()},f=x.compose(s,l),d=(t=c,e=n.clientX,r=n.clientY,o=l,i=s,a=f,u=n,{target:x.constant(t),x:x.constant(e),y:x.constant(r),stop:o,prevent:i,kill:a,raw:x.constant(u)});g(d)}});return n.dom().addEventListener(t,i,o),{unbind:x.curry(Ja,n,t,i,o)}},Ja=function(n,t,e,r){n.dom().removeEventListener(t,e,r)},$a=x.constant(!0),Qa=function(n,t,e){return Ka(n,t,$a,e,!1)},Za=Xa.mode({compare:function(n,t){return wr(t.left()-n.left(),t.top()-n.top())},extract:function(n){return R.some(wr(n.x(),n.y()))},sink:function(n,t){var e,r,o,i=(e=t,r=ro.merge({layerClass:Ya.resolve("blocker")},e),o=y.fromTag("div"),lt.set(o,"role","presentation"),Xt.setAll(o,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"}),Bo(o,Ya.resolve("blocker")),Bo(o,r.layerClass),{element:function(){return o},destroy:function(){Zt.remove(o)}}),a=Qa(i.element(),"mousedown",n.forceDrop),u=Qa(i.element(),"mouseup",n.drop),c=Qa(i.element(),"mousemove",n.move),l=Qa(i.element(),"mouseout",n.delayDrop);return Xa.sink({element:i.element,start:function(n){Jt.append(n,i.element())},stop:function(){Zt.remove(i.element())},destroy:function(){i.destroy(),u.unbind(),c.unbind(),l.unbind(),a.unbind()}})},mutate:function(n,t){n.mutate(t.left(),t.top())}});function nu(){var i,a,n={onEvent:function(n,t){},reset:x.noop},t=(i=R.none(),{onEvent:function(n,o){o.extract(n).each(function(n){var t,e,r;(t=o,e=n,r=i.map(function(n){return t.compare(n,e)}),i=R.some(e),r).each(function(n){a.trigger.move(n)})})},reset:function(){i=R.none()},events:(a=Ga.create({move:Ua(["info"])})).registry}),e=n;return{on:function(){e.reset(),e=t},off:function(){e.reset(),e=n},isOn:function(){return e===t},onEvent:function(n,t){e.onEvent(n,t)},events:t.events}}var tu=function(t,e,n){var r,o,i,a=!1,u=Ga.create({start:Ua([]),stop:Ua([])}),c=nu(),l=function(){d.stop(),c.isOn()&&(c.off(),u.trigger.stop())},s=(r=l,o=200,i=null,{cancel:function(){null!==i&&(clearTimeout(i),i=null)},throttle:function(){var n=arguments;null!==i&&clearTimeout(i),i=setTimeout(function(){r.apply(null,n),n=i=null},o)}});c.events.move.bind(function(n){e.mutate(t,n.info())});var f=function(t){return function(){var n=Array.prototype.slice.call(arguments,0);if(a)return t.apply(null,n)}},d=e.sink(Xa.api({forceDrop:l,drop:f(l),move:f(function(n,t){s.cancel(),c.onEvent(n,e)}),delayDrop:f(s.throttle)}),n);return{element:d.element,go:function(n){d.start(n),c.on(),u.trigger.start()},on:function(){a=!0},off:function(){a=!1},destroy:function(){d.destroy()},events:u.registry}},eu=function(n,t){var e=void 0!==t?t:{},r=void 0!==e.mode?e.mode:Za;return tu(n,r,t)};var ru=function(n,t,e){return Dt.closest(n,t,e).isSome()},ou=Do.resolve("resizer-bar-dragging");function iu(n,e){var r=Er.height,t=function(o,t,i){var e,r,a,n,u=(r=Ga.create({drag:Ua(["xDelta","yDelta","target"])}),a=R.none(),(n={mutate:function(n,t){e.trigger.drag(n,t)},events:(e=Ga.create({drag:Ua(["xDelta","yDelta"])})).registry}).events.drag.bind(function(t){a.each(function(n){r.trigger.drag(t.xDelta(),t.yDelta(),n)})}),{assign:function(n){a=R.some(n)},get:function(){return a},mutate:n.mutate,events:r.registry}),c=eu(u,{}),l=R.none(),s=function(n,t){return R.from(lt.get(n,t))};u.events.drag.bind(function(e){s(e.target(),"data-row").each(function(n){var t=xi.getInt(e.target(),"top");Xt.set(e.target(),"top",t+e.yDelta()+"px")}),s(e.target(),"data-column").each(function(n){var t=xi.getInt(e.target(),"left");Xt.set(e.target(),"left",t+e.xDelta()+"px")})});var f=function(n,t){return xi.getInt(n,t)-parseInt(lt.get(n,"data-initial-"+t),10)};c.events.stop.bind(function(){u.get().each(function(r){l.each(function(e){s(r,"data-row").each(function(n){var t=f(r,"top");lt.remove(r,"data-initial-top"),h.trigger.adjustHeight(e,t,parseInt(n,10))}),s(r,"data-column").each(function(n){var t=f(r,"left");lt.remove(r,"data-initial-left"),h.trigger.adjustWidth(e,t,parseInt(n,10))}),Lo(o,e,i,t)})})});var d=function(n,t){h.trigger.startAdjust(),u.assign(n),lt.set(n,"data-initial-"+t,parseInt(Xt.get(n,t),10)),Bo(n,ou),Xt.set(n,"opacity","0.2"),c.go(o.parent())},m=Qa(o.parent(),"mousedown",function(n){Uo(n.target())&&d(n.target(),"top"),Go(n.target())&&d(n.target(),"left")}),g=function(n){return Ln.eq(n,o.view())},p=Qa(o.view(),"mouseover",function(n){"table"===ot.name(n.target())||ru(n.target(),"table",g)?(l="table"===ot.name(n.target())?R.some(n.target()):Dt.ancestor(n.target(),"table",g)).each(function(n){Lo(o,n,i,t)}):dt.inBody(n.target())&&Vo(o)}),h=Ga.create({adjustHeight:Ua(["table","delta","row"]),adjustWidth:Ua(["table","delta","column"]),startAdjust:Ua([])});return{destroy:function(){m.unbind(),p.unbind(),c.destroy(),Vo(o)},refresh:function(n){Lo(o,n,i,t)},on:c.on,off:c.off,hideBars:x.curry(Fo,o),showBars:x.curry(Ho,o),events:h.registry}}(n,e,r),o=Ga.create({beforeResize:Ua(["table"]),afterResize:Ua(["table"]),startDrag:Ua([])});return t.events.adjustHeight.bind(function(n){o.trigger.beforeResize(n.table());var t=r.delta(n.delta(),n.table());Mi(n.table(),t,n.row(),r),o.trigger.afterResize(n.table())}),t.events.startAdjust.bind(function(n){o.trigger.startDrag()}),t.events.adjustWidth.bind(function(n){o.trigger.beforeResize(n.table());var t=e.delta(n.delta(),n.table());Wi(n.table(),t,n.column(),e),o.trigger.afterResize(n.table())}),{on:t.on,off:t.off,hideBars:t.hideBars,showBars:t.showBars,destroy:t.destroy,events:o.registry}}var au=function(n,t){return n.inline?(e=Yi(n),r=y.fromTag("div"),Xt.setAll(r,{position:"static",height:"0",width:"0",padding:"0",margin:"0",border:"0"}),Jt.append(dt.body(),r),{parent:x.constant(r),view:x.constant(e),origin:x.constant(wr(0,0))}):Va(y.fromDom(n.getDoc()));var e,r},uu=function(a){var u,c,o=R.none(),i=R.none(),l=R.none(),s=/(\d+(\.\d+)?)%/,f=function(n){return"TABLE"===n.nodeName};return a.on("init",function(){var n,t=Wr(ra),e=au(a);if(l=R.some(e),("table"===(n=a.getParam("object_resizing",!0))||n)&&a.getParam("table_resize_bars",!0,"boolean")){var r=iu(e,t);r.on(),r.events.startDrag.bind(function(n){o=R.some(a.selection.getRng())}),r.events.beforeResize.bind(function(n){var t=n.table().dom();va(a,t,Ki(t),Ji(t))}),r.events.afterResize.bind(function(n){var t=n.table(),e=t.dom(),r=pt.descendants(t,"td[data-mce-style],th[data-mce-style]");E.each(r,function(n){lt.remove(n,"data-mce-style")}),o.each(function(n){a.selection.setRng(n),a.focus()}),ba(a,e,Ki(e),Ji(e)),a.undoManager.add()}),i=R.some(r)}}),a.on("ObjectResizeStart",function(n){var t,e=n.target;f(e)&&(u=n.width,t=e,c=a.dom.getStyle(t,"width")||a.dom.getAttrib(t,"width"))}),a.on("ObjectResized",function(n){var t=n.target;if(f(t)){var e=t;if(s.test(c)){var r=parseFloat(s.exec(c)[1]),o=n.width*r/u;a.dom.setStyle(e,"width",o+"%")}else{var i=[];ya.each(e.rows,function(n){ya.each(n.cells,function(n){var t=a.dom.getStyle(n,"width",!0);i.push({cell:n,width:t})})}),ya.each(i,function(n){a.dom.setStyle(n.cell,"width",n.width),a.dom.setAttrib(n.cell,"width",null)})}}}),{lazyResize:function(){return i},lazyWire:function(){return l.getOr(Va(y.fromDom(a.getBody())))},destroy:function(){i.each(function(n){n.destroy()}),l.each(function(n){var t;t=n,a.inline&&Zt.remove(t.parent())})}}},cu=function(n){return{fold:n}},lu=function(o){return cu(function(n,t,e,r){return n(o)})},su=function(o,i){return cu(function(n,t,e,r){return e(o,i)})},fu=function(e,n){return Nt(e,n).bind(function(n){var t=Pt(n);return E.findIndex(t,function(n){return Ln.eq(e,n)}).map(function(n){return{index:x.constant(n),all:x.constant(t)}})})},du=function(t,n){return fu(t,n).fold(function(){return lu(t)},function(n){return n.index()+1<n.all().length?su(t,n.all()[n.index()+1]):(o=t,cu(function(n,t,e,r){return r(o)}));var o})},mu=function(t,n){return fu(t,n).fold(function(){return lu()},function(n){return 0<=n.index()-1?su(t,n.all()[n.index()-1]):(o=t,cu(function(n,t,e,r){return t(o)}));var o})},gu=Ge([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),pu={before:gu.before,on:gu.on,after:gu.after,cata:function(n,t,e,r){return n.fold(t,e,r)},getStart:function(n){return n.fold(x.identity,x.identity,x.identity)}},hu=Ge([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),vu=G.immutable("start","soffset","finish","foffset"),bu={domRange:hu.domRange,relative:hu.relative,exact:hu.exact,exactFromRange:function(n){return hu.exact(n.start(),n.soffset(),n.finish(),n.foffset())},range:vu,getWin:function(n){var t=n.match({domRange:function(n){return y.fromDom(n.startContainer)},relative:function(n,t){return pu.getStart(n)},exact:function(n,t,e,r){return n}});return Kn.defaultView(t)}},wu=function(n,t,e,r){var o,i,a,u,c,l=(i=t,a=e,u=r,(c=Kn.owner(o=n).dom().createRange()).setStart(o.dom(),i),c.setEnd(a.dom(),u),c),s=Ln.eq(n,e)&&t===r;return l.collapsed&&!s},yu=function(n,t){n.selectNodeContents(t.dom())},xu=function(n){return{left:x.constant(n.left),top:x.constant(n.top),right:x.constant(n.right),bottom:x.constant(n.bottom),width:x.constant(n.width),height:x.constant(n.height)}},Ru=function(n,t){var e=n.document.createRange();return yu(e,t),e},Cu=function(n,t,e){var r,o,i=n.document.createRange();return r=i,t.fold(function(n){r.setStartBefore(n.dom())},function(n,t){r.setStart(n.dom(),t)},function(n){r.setStartAfter(n.dom())}),o=i,e.fold(function(n){o.setEndBefore(n.dom())},function(n,t){o.setEnd(n.dom(),t)},function(n){o.setEndAfter(n.dom())}),i},Su=function(n,t,e,r,o){var i=n.document.createRange();return i.setStart(t.dom(),e),i.setEnd(r.dom(),o),i},Tu=function(n){var t=n.getClientRects(),e=0<t.length?t[0]:n.getBoundingClientRect();return 0<e.width||0<e.height?R.some(e).map(xu):R.none()},Du=Ge([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),ku=function(n,t,e){return t(y.fromDom(e.startContainer),e.startOffset,y.fromDom(e.endContainer),e.endOffset)},Ou=function(n,t){var o,e,r,i=(o=n,t.match({domRange:function(n){return{ltr:x.constant(n),rtl:R.none}},relative:function(n,t){return{ltr:cn(function(){return Cu(o,n,t)}),rtl:cn(function(){return R.some(Cu(o,t,n))})}},exact:function(n,t,e,r){return{ltr:cn(function(){return Su(o,n,t,e,r)}),rtl:cn(function(){return R.some(Su(o,e,r,n,t))})}}}));return(r=(e=i).ltr()).collapsed?e.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return Du.rtl(y.fromDom(n.endContainer),n.endOffset,y.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return ku(0,Du.ltr,r)}):ku(0,Du.ltr,r)},Au=(Du.ltr,Du.rtl,Ou),Pu=function(i,n){return Ou(i,n).match({ltr:function(n,t,e,r){var o=i.document.createRange();return o.setStart(n.dom(),t),o.setEnd(e.dom(),r),o},rtl:function(n,t,e,r){var o=i.document.createRange();return o.setStart(e.dom(),r),o.setEnd(n.dom(),t),o}})},Nu=function(n,t,e){return t>=n.left&&t<=n.right&&e>=n.top&&e<=n.bottom},Bu=function(l,s,f,d){var n=l.dom().createRange();n.selectNode(s.dom());var t=n.getClientRects();return io(t,function(n){return Nu(n,f,d)?R.some(n):R.none()}).map(function(n){return e=l,t=f,o=d,i=n,a=function(n){var t=e.dom().createRange();return t.setStart(r.dom(),n),t.collapse(!0),t},u=ue.get(r=s).length,c=function(n,t,e,r,o){if(0===o)return 0;if(t===r)return o-1;for(var i=r,a=1;a<o;a++){var u=n(a),c=Math.abs(t-u.left);if(e>u.bottom);else{if(e<u.top||i<c)return a-1;i=c}}return 0}(function(n){return a(n).getBoundingClientRect()},t,o,i.right,u),a(c);var e,r,t,o,i,a,u,c})},Eu=function(n,t,e,r){return(ot.isText(t)?Bu:function(t,n,e,r){var o=t.dom().createRange(),i=Kn.children(n);return io(i,function(n){return o.selectNode(n.dom()),Nu(o.getBoundingClientRect(),e,r)?Eu(t,n,e,r):R.none()})})(n,t,e,r)},Iu=function(n,t){return t-n.left<n.right-t},Wu=function(n,t,e){var r=n.dom().createRange();return r.selectNode(t.dom()),r.collapse(e),r},Mu=function(n,t,e){return(0===Kn.children(t).length?function(n,t,e){var r=t.dom().getBoundingClientRect(),o=Iu(r,e);return R.some(Wu(n,t,o))}:function(t,n,e){var r=t.dom().createRange();r.selectNode(n.dom());var o=r.getBoundingClientRect(),i=Iu(o,e);return(!0===i?fe:de)(n).map(function(n){return Wu(t,n,i)})})(n,t,e)},qu=document.caretPositionFromPoint?function(e,n,t){return R.from(e.dom().caretPositionFromPoint(n,t)).bind(function(n){if(null===n.offsetNode)return R.none();var t=e.dom().createRange();return t.setStart(n.offsetNode,n.offset),t.collapse(),R.some(t)})}:document.caretRangeFromPoint?function(n,t,e){return R.from(n.dom().caretRangeFromPoint(t,e))}:function(e,r,o){return y.fromPoint(e,r,o).bind(function(n){var t=function(){return Mu(e,n,r)};return 0===Kn.children(n).length?t():function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var i=o.getBoundingClientRect();return function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var i=o.getBoundingClientRect(),a=Math.max(i.left,Math.min(i.right,e)),u=Math.max(i.top,Math.min(i.bottom,r));return Eu(n,t,a,u)}(n,t,Math.max(i.left,Math.min(i.right,e)),Math.max(i.top,Math.min(i.bottom,r)))}(e,n,r,o).orThunk(t)})},ju=function(n,t){var e=ot.name(n);return"input"===e?pu.after(n):E.contains(["br","img"],e)?0===t?pu.before(n):pu.after(n):pu.on(n,t)},zu=function(n,t){var e=n.fold(pu.before,ju,pu.after),r=t.fold(pu.before,ju,pu.after);return bu.relative(e,r)},_u=function(n,t,e,r){var o=ju(n,t),i=ju(e,r);return bu.relative(o,i)},Lu=zu,Fu=_u,Hu=function(n,t){R.from(n.getSelection()).each(function(n){n.removeAllRanges(),n.addRange(t)})},Vu=function(n,t,e,r,o){var i=Su(n,t,e,r,o);Hu(n,i)},Uu=function(i,n){return Au(i,n).match({ltr:function(n,t,e,r){Vu(i,n,t,e,r)},rtl:function(n,t,e,r){var o=i.getSelection();o.setBaseAndExtent?o.setBaseAndExtent(n.dom(),t,e.dom(),r):o.extend?(o.collapse(n.dom(),t),o.extend(e.dom(),r)):Vu(i,e,r,n,t)}})},Gu=function(n){var t=y.fromDom(n.anchorNode),e=y.fromDom(n.focusNode);return wu(t,n.anchorOffset,e,n.focusOffset)?R.some(bu.range(y.fromDom(n.anchorNode),n.anchorOffset,y.fromDom(n.focusNode),n.focusOffset)):function(n){if(0<n.rangeCount){var t=n.getRangeAt(0),e=n.getRangeAt(n.rangeCount-1);return R.some(bu.range(y.fromDom(t.startContainer),t.startOffset,y.fromDom(e.endContainer),e.endOffset))}return R.none()}(n)},Xu=function(n){return R.from(n.getSelection()).filter(function(n){return 0<n.rangeCount}).bind(Gu)},Yu=function(n,t,e,r,o){var i=Fu(t,e,r,o);Uu(n,i)},Ku=function(n){return Xu(n).map(function(n){return bu.exact(n.start(),n.soffset(),n.finish(),n.foffset())})},Ju=function(n,t,e){var r=Lu(t,e);Uu(n,r)},$u=function(n){var o=bu.getWin(n).dom(),t=function(n,t,e,r){return Su(o,n,t,e,r)},e=n.match({domRange:function(n){var t=y.fromDom(n.startContainer),e=y.fromDom(n.endContainer);return _u(t,n.startOffset,e,n.endOffset)},relative:zu,exact:_u});return Au(o,e).match({ltr:t,rtl:t})},Qu=function(n,t){var e=Ru(n,t);Hu(n,e)},Zu=function(n){n.getSelection().removeAllRanges()},nc=function(n,t){var e=Pu(n,t);return Tu(e)},tc=function(n,t,e){return r=t,o=e,i=y.fromDom(n.document),qu(i,r,o).map(function(n){return bu.range(y.fromDom(n.startContainer),n.startOffset,y.fromDom(n.endContainer),n.endOffset)});var r,o,i},ec=tinymce.util.Tools.resolve("tinymce.util.VK"),rc=function(n,t){var e=bu.exact(t,0,t,0);return $u(e)},oc=function(o,n,t,i,e){return t.fold(R.none,R.none,function(n,t){return fe(t).map(function(n){return rc(0,n)})},function(r){return Nt(r,n).bind(function(n){var t,e=Ze.noMenu(r);return o.undoManager.transact(function(){i.insertRowsAfter(n,e)}),t=pt.descendants(n,"tr"),E.last(t).bind(function(n){return Dt.descendant(n,"td,th").map(function(n){return rc(0,n)})})})})},ic=["table","li","dl"],ac=function(t,e,r,o){if(t.keyCode===ec.TAB){var i=Yi(e),a=function(n){var t=ot.name(n);return Ln.eq(n,i)||E.contains(ic,t)},n=e.selection.getRng();if(n.collapsed){var u=y.fromDom(n.startContainer);At(u,a).each(function(n){t.preventDefault(),(t.shiftKey?function(n,t,e,r){return oc(n,t,mu(e),r)}:function(n,t,e,r){return oc(n,t,du(e),r)})(e,a,n,r,o).each(function(n){e.selection.setRng(n)})})}}},uc={response:G.immutable("selection","kill")},cc=function(t){return function(n){return n===t}},lc=cc(38),sc=cc(40),fc={ltr:{isBackward:cc(37),isForward:cc(39)},rtl:{isBackward:cc(39),isForward:cc(37)},isUp:lc,isDown:sc,isNavigation:function(n){return 37<=n&&n<=40}},dc=function(n,t){var e=Pu(n,t);return{start:x.constant(y.fromDom(e.startContainer)),soffset:x.constant(e.startOffset),finish:x.constant(y.fromDom(e.endContainer)),foffset:x.constant(e.endOffset)}},mc=function(n,t,e,r){return{start:x.constant(pu.on(n,t)),finish:x.constant(pu.on(e,r))}},gc=(jn.detect().browser.isSafari(),function(n){var t=void 0!==n?n.dom():document,e=t.body.scrollLeft||t.documentElement.scrollLeft,r=t.body.scrollTop||t.documentElement.scrollTop;return wr(e,r)}),pc=gc,hc=function(n,t,e){(void 0!==e?e.dom():document).defaultView.scrollBy(n,t)};function vc(i){return{elementFromPoint:function(n,t){return y.fromPoint(y.fromDom(i.document),n,t)},getRect:function(n){return n.dom().getBoundingClientRect()},getRangedRect:function(n,t,e,r){var o=bu.exact(n,t,e,r);return nc(i,o).map(function(n){return z.map(n,x.apply)})},getSelection:function(){return Ku(i).map(function(n){return dc(i,n)})},fromSitus:function(n){var t=bu.relative(n.start(),n.finish());return dc(i,t)},situsFromPoint:function(n,t){return tc(i,n,t).map(function(n){return{start:x.constant(pu.on(n.start(),n.soffset())),finish:x.constant(pu.on(n.finish(),n.foffset()))}})},clearSelection:function(){Zu(i)},setSelection:function(n){Yu(i,n.start(),n.soffset(),n.finish(),n.foffset())},setRelativeSelection:function(n,t){Ju(i,n,t)},selectContents:function(n){Qu(i,n)},getInnerHeight:function(){return i.innerHeight},getScrollY:function(){return pc(y.fromDom(i.document)).top()},scrollBy:function(n,t){hc(n,t,y.fromDom(i.document))}}}var bc=function(e,n,r,t,o){return Ln.eq(r,t)?R.none():_e(r,t,n).bind(function(n){var t=n.boxes().getOr([]);return 0<t.length?(o(e,t,n.start(),n.finish()),R.some(uc.response(R.some(mc(r,0,r,le(r))),!0))):R.none()})},wc=function(e,r,n,t,o,i,a){return Ln.eq(n,o)&&t===i?R.none():Dt.closest(n,"td,th",r).bind(function(t){return Dt.closest(o,"td,th",r).bind(function(n){return bc(e,r,t,n,a)})})},yc=bc,xc=function(n,t,e,r,o){return Fe(r,n,t,o.firstSelectedSelector(),o.lastSelectedSelector()).map(function(n){return o.clear(e),o.selectRange(e,n.boxes(),n.start(),n.finish()),n.boxes()})},Rc=G.immutableBag(["left","top","right","bottom"],[]),Cc={nu:Rc,moveUp:function(n,t){return Rc({left:n.left(),top:n.top()-t,right:n.right(),bottom:n.bottom()-t})},moveDown:function(n,t){return Rc({left:n.left(),top:n.top()+t,right:n.right(),bottom:n.bottom()+t})},moveBottomTo:function(n,t){var e=n.bottom()-n.top();return Rc({left:n.left(),top:t-e,right:n.right(),bottom:t})},moveTopTo:function(n,t){var e=n.bottom()-n.top();return Rc({left:n.left(),top:t,right:n.right(),bottom:t+e})},getTop:function(n){return n.top()},getBottom:function(n){return n.bottom()},translate:function(n,t,e){return Rc({left:n.left()+t,top:n.top()+e,right:n.right()+t,bottom:n.bottom()+e})},toString:function(n){return"("+n.left()+", "+n.top()+") -> ("+n.right()+", "+n.bottom()+")"}},Sc=function(n){return Cc.nu({left:n.left,top:n.top,right:n.right,bottom:n.bottom})},Tc=function(n,t){return R.some(n.getRect(t))},Dc=function(n,t,e){return ot.isElement(t)?Tc(n,t).map(Sc):ot.isText(t)?(r=n,o=t,i=e,0<=i&&i<le(o)?r.getRangedRect(o,i,o,i+1):0<i?r.getRangedRect(o,i-1,o,i):R.none()).map(Sc):R.none();var r,o,i},kc=function(n,t){return ot.isElement(t)?Tc(n,t).map(Sc):ot.isText(t)?n.getRangedRect(t,0,t,le(t)).map(Sc):R.none()},Oc=G.immutable("item","mode"),Ac=function(n,t,e,r){var o=void 0!==r?r:Pc;return n.property().parent(t).map(function(n){return Oc(n,o)})},Pc=function(n,t,e,r){var o=void 0!==r?r:Nc;return e.sibling(n,t).map(function(n){return Oc(n,o)})},Nc=function(n,t,e,r){var o=void 0!==r?r:Nc,i=n.property().children(t);return e.first(i).map(function(n){return Oc(n,o)})},Bc=[{current:Ac,next:Pc,fallback:R.none()},{current:Pc,next:Nc,fallback:R.some(Ac)},{current:Nc,next:Nc,fallback:R.some(Pc)}],Ec=function(t,e,r,o,n){return n=void 0!==n?n:Bc,E.find(n,function(n){return n.current===r}).bind(function(n){return n.current(t,e,o,n.next).orThunk(function(){return n.fallback.bind(function(n){return Ec(t,e,n,o)})})})},Ic={backtrack:Ac,sidestep:Pc,advance:Nc,go:Ec},Wc={left:function(){return{sibling:function(n,t){return n.query().prevSibling(t)},first:function(n){return 0<n.length?R.some(n[n.length-1]):R.none()}}},right:function(){return{sibling:function(n,t){return n.query().nextSibling(t)},first:function(n){return 0<n.length?R.some(n[0]):R.none()}}}},Mc=function(t,n,e,r,o,i){return Ic.go(t,n,r,o).bind(function(n){return i(n.item())?R.none():e(n.item())?R.some(n.item()):Mc(t,n.item(),e,n.mode(),o,i)})},qc=function(n,t){return 0===n.property().children(t).length},jc=function(n,t,e,r){return o=r,Mc(n,t,e,Ic.sidestep,Wc.left(),o);var o},zc=function(n,t,e,r){return o=r,Mc(n,t,e,Ic.sidestep,Wc.right(),o);var o},_c={before:function(n,t,e){return jc(n,t,x.curry(qc,n),e)},after:function(n,t,e){return zc(n,t,x.curry(qc,n),e)},seekLeft:jc,seekRight:zc,walkers:function(){return{left:Wc.left,right:Wc.right}},walk:function(n,t,e,r,o){return Ic.go(n,t,e,r,o)},backtrack:Ic.backtrack,sidestep:Ic.sidestep,advance:Ic.advance},Lc=ye(),Fc={gather:function(n,t,e){return _c.gather(Lc,n,t,e)},before:function(n,t){return _c.before(Lc,n,t)},after:function(n,t){return _c.after(Lc,n,t)},seekLeft:function(n,t,e){return _c.seekLeft(Lc,n,t,e)},seekRight:function(n,t,e){return _c.seekRight(Lc,n,t,e)},walkers:function(){return _c.walkers()},walk:function(n,t,e,r){return _c.walk(Lc,n,t,e,r)}},Hc=Ge([{none:[]},{retry:["caret"]}]),Vc=function(t,n,r){return St.closest(n,$r).fold(x.constant(!1),function(n){return kc(t,n).exists(function(n){return e=n,(t=r).left()<e.left()||Math.abs(e.right()-t.left())<1||t.left()>e.right();var t,e})})},Uc={point:Cc.getTop,adjuster:function(n,t,e,r,o){var i=Cc.moveUp(o,5);return Math.abs(e.top()-r.top())<1?Hc.retry(i):e.bottom()<o.top()?Hc.retry(i):e.bottom()===o.top()?Hc.retry(Cc.moveUp(o,1)):Vc(n,t,o)?Hc.retry(Cc.translate(i,5,0)):Hc.none()},move:Cc.moveUp,gather:Fc.before},Gc={point:Cc.getBottom,adjuster:function(n,t,e,r,o){var i=Cc.moveDown(o,5);return Math.abs(e.bottom()-r.bottom())<1?Hc.retry(i):e.top()>o.bottom()?Hc.retry(i):e.top()===o.bottom()?Hc.retry(Cc.moveDown(o,1)):Vc(n,t,o)?Hc.retry(Cc.translate(i,5,0)):Hc.none()},move:Cc.moveDown,gather:Fc.after},Xc=function(e,r,o,i,a){return 0===a?R.some(i):(c=e,l=i.left(),s=r.point(i),c.elementFromPoint(l,s).filter(function(n){return"table"===ot.name(n)}).isSome()?(t=i,u=a-1,Xc(e,n=r,o,n.move(t,5),u)):e.situsFromPoint(i.left(),r.point(i)).bind(function(n){return n.start().fold(R.none,function(t,n){return kc(e,t).bind(function(n){return r.adjuster(e,t,n,o,i).fold(R.none,function(n){return Xc(e,r,o,n,a-1)})}).orThunk(function(){return R.some(i)})},R.none)}));var n,t,u,c,l,s},Yc=function(t,e,n){var r,o,i,a=t.move(n,5),u=Xc(e,t,n,a,100).getOr(a);return(r=t,o=u,i=e,r.point(o)>i.getInnerHeight()?R.some(r.point(o)-i.getInnerHeight()):r.point(o)<0?R.some(-r.point(o)):R.none()).fold(function(){return e.situsFromPoint(u.left(),t.point(u))},function(n){return e.scrollBy(0,n),e.situsFromPoint(u.left(),t.point(u)-n)})},Kc={tryUp:x.curry(Yc,Uc),tryDown:x.curry(Yc,Gc),ieTryUp:function(n,t){return n.situsFromPoint(t.left(),t.top()-5)},ieTryDown:function(n,t){return n.situsFromPoint(t.left(),t.bottom()+5)},getJumpSize:x.constant(5)},Jc=Ge([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),$c=function(n){return Dt.closest(n,"tr")},Qc={verify:function(u,n,t,e,r,c,o){return Dt.closest(e,"td,th",o).bind(function(a){return Dt.closest(n,"td,th",o).map(function(i){return Ln.eq(a,i)?Ln.eq(e,a)&&le(a)===r?c(i):Jc.none("in same cell"):Te($c,[a,i]).fold(function(){return t=i,e=a,r=(n=u).getRect(t),(o=n.getRect(e)).right>r.left&&o.left<r.right?Jc.success():c(i);var n,t,e,r,o},function(n){return c(i)})})}).getOr(Jc.none("default"))},cata:function(n,t,e,r,o){return n.fold(t,e,r,o)},adt:Jc},Zc={point:G.immutable("element","offset"),delta:G.immutable("element","deltaOffset"),range:G.immutable("element","start","finish"),points:G.immutable("begin","end"),text:G.immutable("element","text")},nl=(G.immutable("ancestor","descendants","element","index"),G.immutable("parent","children","element","index")),tl=function(o){return Kn.parent(o).bind(function(t){var n,e,r=Kn.children(t);return(n=r,e=o,E.findIndex(n,x.curry(Ln.eq,e))).map(function(n){return nl(t,r,o,n)})})},el=function(n){return"br"===ot.name(n)},rl=function(n,t,e){return t(n,e).bind(function(n){return ot.isText(n)&&0===ue.get(n).trim().length?rl(n,t,e):R.some(n)})},ol=function(n,t,e,r){var o,i,a,u,c,l,s,f,d;return(el(t)?(o=n,i=t,(a=r).traverse(i).orThunk(function(){return rl(i,a.gather,o)}).map(a.relative)):(u=n,c=t,l=e,s=r,(f=c,d=l,Kn.child(f,d).filter(el).orThunk(function(){return Kn.child(f,d-1).filter(el)})).bind(function(n){return s.traverse(n).fold(function(){return rl(n,s.gather,u).map(s.relative)},function(n){return tl(n).map(function(n){return pu.on(n.parent(),n.index())})})}))).map(function(n){return{start:x.constant(n),finish:x.constant(n)}})},il=jn.detect(),al=function(r,o,i,a,u,c){return 0===c?R.none():ll(r,o,i,a,u).bind(function(n){var t=r.fromSitus(n),e=Qc.verify(r,i,a,t.finish(),t.foffset(),u.failure,o);return Qc.cata(e,function(){return R.none()},function(){return R.some(n)},function(n){return Ln.eq(i,n)&&0===a?ul(r,i,a,Cc.moveUp,u):al(r,o,n,0,u,c-1)},function(n){return Ln.eq(i,n)&&a===le(n)?ul(r,i,a,Cc.moveDown,u):al(r,o,n,le(n),u,c-1)})})},ul=function(t,n,e,r,o){return Dc(t,n,e).bind(function(n){return cl(t,o,r(n,Kc.getJumpSize()))})},cl=function(n,t,e){return il.browser.isChrome()||il.browser.isSafari()||il.browser.isFirefox()||il.browser.isEdge()?t.otherRetry(n,e):il.browser.isIE()?t.ieRetry(n,e):R.none()},ll=function(t,n,e,r,o){return Dc(t,e,r).bind(function(n){return cl(t,o,n)})},sl=function(t,e,r){return(o=t,i=e,a=r,o.getSelection().bind(function(r){return ol(i,r.finish(),r.foffset(),a).fold(function(){return R.some(Zc.point(r.finish(),r.foffset()))},function(n){var t=o.fromSitus(n),e=Qc.verify(o,r.finish(),r.foffset(),t.finish(),t.foffset(),a.failure,i);return Qc.cata(e,function(n){return R.none()},function(){return R.none()},function(n){return R.some(Zc.point(n,0))},function(n){return R.some(Zc.point(n,le(n)))})})})).bind(function(n){return al(t,e,n.element(),n.offset(),r,20).map(t.fromSitus)});var o,i,a},fl=jn.detect(),dl=function(o,i,a,n,u){return Dt.closest(n,"td,th",i).bind(function(r){return Dt.closest(r,"table",i).bind(function(n){return e=n,St.ancestor(u,function(n){return Kn.parent(n).exists(function(n){return Ln.eq(n,e)})},t).isSome()?sl(o,i,a).bind(function(t){return Dt.closest(t.finish(),"td,th",i).map(function(n){return{start:x.constant(r),finish:x.constant(n),range:x.constant(t)}})}):R.none();var t,e})})},ml=function(n,t,e,r,o,i){return fl.browser.isIE()?R.none():i(r,t).orThunk(function(){return dl(n,t,e,r,o).map(function(n){var t=n.range();return uc.response(R.some(mc(t.start(),t.soffset(),t.finish(),t.foffset())),!0)})})},gl=function(n,t,e,r,o,i,a){return dl(n,e,r,o,i).bind(function(n){return yc(t,e,n.start(),n.finish(),a)})},pl=function(n,r){return Dt.closest(n,"tr",r).bind(function(e){return Dt.closest(e,"table",r).bind(function(n){var t=pt.descendants(n,"tr");return Ln.eq(e,t[0])?Fc.seekLeft(n,function(n){return de(n).isSome()},r).map(function(n){var t=le(n);return uc.response(R.some(mc(n,t,n,t)),!0)}):R.none()})})},hl=function(n,r){return Dt.closest(n,"tr",r).bind(function(e){return Dt.closest(e,"table",r).bind(function(n){var t=pt.descendants(n,"tr");return Ln.eq(e,t[t.length-1])?Fc.seekRight(n,function(n){return fe(n).isSome()},r).map(function(n){return uc.response(R.some(mc(n,0,n,0)),!0)}):R.none()})})},vl=function(n,t){return Dt.closest(n,"td,th",t)},bl={down:{traverse:Kn.nextSibling,gather:Fc.after,relative:pu.before,otherRetry:Kc.tryDown,ieRetry:Kc.ieTryDown,failure:Qc.adt.failedDown},up:{traverse:Kn.prevSibling,gather:Fc.before,relative:pu.before,otherRetry:Kc.tryUp,ieRetry:Kc.ieTryUp,failure:Qc.adt.failedUp}},wl=G.immutable("rows","cols"),yl=function(n,t,e,r){var o,i,a,u,c,l,s=vc(n),f=(o=s,i=t,a=e,u=r,c=R.none(),l=function(){c=R.none()},{mousedown:function(n){u.clear(i),c=vl(n.target(),a)},mouseover:function(n){c.each(function(r){u.clear(i),vl(n.target(),a).each(function(e){_e(r,e,a).each(function(n){var t=n.boxes().getOr([]);(1<t.length||1===t.length&&!Ln.eq(r,e))&&(u.selectRange(i,t,n.start(),n.finish()),o.selectContents(e))})})})},mouseup:function(){c.each(l)}});return{mousedown:f.mousedown,mouseover:f.mouseover,mouseup:f.mouseup}},xl=function(n,c,l,s){var f=vc(n),d=function(){return s.clear(c),R.none()};return{keydown:function(n,t,e,r,o,i){var a=n.raw().which,u=!0===n.raw().shiftKey;return Le(c,s.selectedSelector()).fold(function(){return fc.isDown(a)&&u?x.curry(gl,f,c,l,bl.down,r,t,s.selectRange):fc.isUp(a)&&u?x.curry(gl,f,c,l,bl.up,r,t,s.selectRange):fc.isDown(a)?x.curry(ml,f,l,bl.down,r,t,hl):fc.isUp(a)?x.curry(ml,f,l,bl.up,r,t,pl):R.none},function(t){var n=function(n){return function(){return io(n,function(n){return xc(n.rows(),n.cols(),c,t,s)}).fold(function(){return He(c,s.firstSelectedSelector(),s.lastSelectedSelector()).map(function(n){var t=fc.isDown(a)||i.isForward(a)?pu.after:pu.before;return f.setRelativeSelection(pu.on(n.first(),0),t(n.table())),s.clear(c),uc.response(R.none(),!0)})},function(n){return R.some(uc.response(R.none(),!0))})}};return fc.isDown(a)&&u?n([wl(1,0)]):fc.isUp(a)&&u?n([wl(-1,0)]):i.isBackward(a)&&u?n([wl(0,-1),wl(-1,0)]):i.isForward(a)&&u?n([wl(0,1),wl(1,0)]):fc.isNavigation(a)&&!1===u?d:R.none})()},keyup:function(t,e,r,o,i){return Le(c,s.selectedSelector()).fold(function(){var n=t.raw().which;return 0==(!0===t.raw().shiftKey)?R.none():fc.isNavigation(n)?wc(c,l,e,r,o,i,s.selectRange):R.none()},R.none)}}},Rl=function(o){var e=function(n){lt.remove(n,o.selected()),lt.remove(n,o.firstSelected()),lt.remove(n,o.lastSelected())},i=function(n){lt.set(n,o.selected(),"1")},a=function(n){var t=pt.descendants(n,o.selectedSelector());E.each(t,e)};return{clear:a,selectRange:function(n,t,e,r){a(n),E.each(t,i),lt.set(e,o.firstSelected(),"1"),lt.set(r,o.lastSelected(),"1")},selectedSelector:o.selectedSelector,firstSelectedSelector:o.firstSelectedSelector,lastSelectedSelector:o.lastSelectedSelector}};var Cl=function(r){return{get:function(){var n,t,e=Yi(r);return(n=e,t=Ue.selectedSelector(),Le(n,t)).fold(function(){return void 0===r.selection.getStart()?Ye.none():Ye.single(r.selection)},function(n){return Ye.multiple(n)})}}},Sl=ya.each,Tl=function(t){var e=[];function n(n){return function(){t.execCommand(n)}}Sl("inserttable tableprops deletetable | cell row column".split(" "),function(n){"|"===n?e.push({text:"-"}):e.push(t.menuItems[n])}),t.addButton("table",{type:"menubutton",title:"Table",menu:e}),t.addButton("tableprops",{title:"Table properties",onclick:x.curry(La,t,!0),icon:"table"}),t.addButton("tabledelete",{title:"Delete table",onclick:n("mceTableDelete")}),t.addButton("tablecellprops",{title:"Cell properties",onclick:n("mceTableCellProps")}),t.addButton("tablemergecells",{title:"Merge cells",onclick:n("mceTableMergeCells")}),t.addButton("tablesplitcells",{title:"Split cell",onclick:n("mceTableSplitCells")}),t.addButton("tableinsertrowbefore",{title:"Insert row before",onclick:n("mceTableInsertRowBefore")}),t.addButton("tableinsertrowafter",{title:"Insert row after",onclick:n("mceTableInsertRowAfter")}),t.addButton("tabledeleterow",{title:"Delete row",onclick:n("mceTableDeleteRow")}),t.addButton("tablerowprops",{title:"Row properties",onclick:n("mceTableRowProps")}),t.addButton("tablecutrow",{title:"Cut row",onclick:n("mceTableCutRow")}),t.addButton("tablecopyrow",{title:"Copy row",onclick:n("mceTableCopyRow")}),t.addButton("tablepasterowbefore",{title:"Paste row before",onclick:n("mceTablePasteRowBefore")}),t.addButton("tablepasterowafter",{title:"Paste row after",onclick:n("mceTablePasteRowAfter")}),t.addButton("tableinsertcolbefore",{title:"Insert column before",onclick:n("mceTableInsertColBefore")}),t.addButton("tableinsertcolafter",{title:"Insert column after",onclick:n("mceTableInsertColAfter")}),t.addButton("tabledeletecol",{title:"Delete column",onclick:n("mceTableDeleteCol")})},Dl=function(t){var n,e=""===(n=t.getParam("table_toolbar",oa))||!1===n?[]:C.isString(n)?n.split(/[ ,]/):C.isArray(n)?n:[];0<e.length&&t.addContextToolbar(function(n){return t.dom.is(n,"table")&&t.getBody().contains(n)},e.join(" "))},kl=function(o,e){var r=R.none(),i=[],a=[],u=[],c=[],l=function(n){n.disabled(!0)},s=function(n){n.disabled(!1)},n=function(){var t=this;i.push(t),r.fold(function(){l(t)},function(n){s(t)})},t=function(){var t=this;a.push(t),r.fold(function(){l(t)},function(n){s(t)})};o.on("init",function(){o.on("nodechange",function(n){var t=R.from(o.dom.getParent(o.selection.getStart(),"th,td"));(r=t.bind(function(n){var t=y.fromDom(n);return Nt(t).map(function(n){return Ze.forMenu(e,n,t)})})).fold(function(){E.each(i,l),E.each(a,l),E.each(u,l),E.each(c,l)},function(t){E.each(i,s),E.each(a,s),E.each(u,function(n){n.disabled(t.mergable().isNone())}),E.each(c,function(n){n.disabled(t.unmergable().isNone())})})})});var f=function(n,t,e,r){var o,i,a,u,c,l=r.getEl().getElementsByTagName("table")[0],s=r.isRtl()||"tl-tr"===r.parent().rel;for(l.nextSibling.innerHTML=t+1+" x "+(e+1),s&&(t=9-t),i=0;i<10;i++)for(o=0;o<10;o++)u=l.rows[i].childNodes[o].firstChild,c=(s?t<=o:o<=t)&&i<=e,n.dom.toggleClass(u,"mce-active",c),c&&(a=u);return a.parentNode},d=!1===o.getParam("table_grid",!0,"boolean")?{text:"Table",icon:"table",context:"table",onclick:x.curry(La,o)}:{text:"Table",icon:"table",context:"table",ariaHideMenu:!0,onclick:function(n){n.aria&&(this.parent().hideAll(),n.stopImmediatePropagation(),La(o))},onshow:function(){f(o,0,0,this.menu.items()[0])},onhide:function(){var n=this.menu.items()[0].getEl().getElementsByTagName("a");o.dom.removeClass(n,"mce-active"),o.dom.addClass(n[0],"mce-active")},menu:[{type:"container",html:function(){var n="";n='<table role="grid" class="mce-grid mce-grid-border" aria-readonly="true">';for(var t=0;t<10;t++){n+="<tr>";for(var e=0;e<10;e++)n+='<td role="gridcell" tabindex="-1"><a id="mcegrid'+(10*t+e)+'" href="#" data-mce-x="'+e+'" data-mce-y="'+t+'"></a></td>';n+="</tr>"}return(n+="</table>")+'<div class="mce-text-center" role="presentation">1 x 1</div>'}(),onPostRender:function(){this.lastX=this.lastY=0},onmousemove:function(n){var t,e,r=n.target;"A"===r.tagName.toUpperCase()&&(t=parseInt(r.getAttribute("data-mce-x"),10),e=parseInt(r.getAttribute("data-mce-y"),10),(this.isRtl()||"tl-tr"===this.parent().rel)&&(t=9-t),t===this.lastX&&e===this.lastY||(f(o,t,e,n.control),this.lastX=t,this.lastY=e))},onclick:function(n){var t=this;"A"===n.target.tagName.toUpperCase()&&(n.preventDefault(),n.stopPropagation(),t.parent().cancel(),o.undoManager.transact(function(){ja(o,t.lastX+1,t.lastY+1)}),o.addVisual())}}]};function m(n){return function(){o.execCommand(n)}}var g={text:"Table properties",context:"table",onPostRender:n,onclick:x.curry(La,o,!0)},p={text:"Delete table",context:"table",onPostRender:n,cmd:"mceTableDelete"},h={text:"Row",context:"table",menu:[{text:"Insert row before",onclick:m("mceTableInsertRowBefore"),onPostRender:t},{text:"Insert row after",onclick:m("mceTableInsertRowAfter"),onPostRender:t},{text:"Delete row",onclick:m("mceTableDeleteRow"),onPostRender:t},{text:"Row properties",onclick:m("mceTableRowProps"),onPostRender:t},{text:"-"},{text:"Cut row",onclick:m("mceTableCutRow"),onPostRender:t},{text:"Copy row",onclick:m("mceTableCopyRow"),onPostRender:t},{text:"Paste row before",onclick:m("mceTablePasteRowBefore"),onPostRender:t},{text:"Paste row after",onclick:m("mceTablePasteRowAfter"),onPostRender:t}]},v={text:"Column",context:"table",menu:[{text:"Insert column before",onclick:m("mceTableInsertColBefore"),onPostRender:t},{text:"Insert column after",onclick:m("mceTableInsertColAfter"),onPostRender:t},{text:"Delete column",onclick:m("mceTableDeleteCol"),onPostRender:t}]},b={separator:"before",text:"Cell",context:"table",menu:[{text:"Cell properties",onclick:m("mceTableCellProps"),onPostRender:t},{text:"Merge cells",onclick:m("mceTableMergeCells"),onPostRender:function(){var t=this;u.push(t),r.fold(function(){l(t)},function(n){t.disabled(n.mergable().isNone())})}},{text:"Split cell",onclick:m("mceTableSplitCells"),onPostRender:function(){var t=this;c.push(t),r.fold(function(){l(t)},function(n){t.disabled(n.unmergable().isNone())})}}]};o.addMenuItem("inserttable",d),o.addMenuItem("tableprops",g),o.addMenuItem("deletetable",p),o.addMenuItem("row",h),o.addMenuItem("column",v),o.addMenuItem("cell",b)};a.add("table",function(t){var f,n,e,r,d,o,p,h,v,b,w,i,a,u=uu(t),c=(p=t,h=u.lazyResize,v=G.immutableBag(["mousedown","mouseover","mouseup","keyup","keydown"],[]),b=R.none(),w=Rl(Ue),p.on("init",function(n){var r=p.getWin(),i=Yi(p),t=$i(p),e=yl(r,i,t,w),u=xl(r,i,t,w),c=function(n,t){!0===n.raw().shiftKey&&(t.kill()&&n.kill(),t.selection().each(function(n){var t=bu.relative(n.start(),n.finish()),e=Pu(r,t);p.selection.setRng(e)}))},o=function(n){var t=s(n);if(t.raw().shiftKey&&fc.isNavigation(t.raw().which)){var e=p.selection.getRng(),r=y.fromDom(e.startContainer),o=y.fromDom(e.endContainer);u.keyup(t,r,e.startOffset,o,e.endOffset).each(function(n){c(t,n)})}},a=function(n){var t=s(n);h().each(function(n){n.hideBars()});var e=p.selection.getRng(),r=y.fromDom(p.selection.getStart()),o=y.fromDom(e.startContainer),i=y.fromDom(e.endContainer),a=ra(r).isRtl()?fc.rtl:fc.ltr;u.keydown(t,o,e.startOffset,i,e.endOffset,a).each(function(n){c(t,n)}),h().each(function(n){n.showBars()})},l=function(n){return n.hasOwnProperty("x")&&n.hasOwnProperty("y")},s=function(n){var t=y.fromDom(n.target),e=function(){n.stopPropagation()},r=function(){n.preventDefault()},o=x.compose(r,e);return{target:x.constant(t),x:x.constant(l(n)?n.x:null),y:x.constant(l(n)?n.y:null),stop:e,prevent:r,kill:o,raw:x.constant(n)}},f=function(n){return 0===n.button},d=function(n){f(n)&&e.mousedown(s(n))},m=function(n){var t;(void 0===(t=n).buttons||0!=(1&t.buttons))&&e.mouseover(s(n))},g=function(n){f(n)&&e.mouseup(s(n))};p.on("mousedown",d),p.on("mouseover",m),p.on("mouseup",g),p.on("keyup",o),p.on("keydown",a),p.on("nodechange",function(){var n=p.selection,t=y.fromDom(n.getStart()),e=y.fromDom(n.getEnd()),r=Nt(t),o=Nt(e);r.bind(function(t){return o.bind(function(n){return Ln.eq(t,n)?R.some(!0):R.none()})}).fold(function(){w.clear(i)},x.noop)}),b=R.some(v({mousedown:d,mouseover:m,mouseup:g,keyup:o,keydown:a}))}),{clear:w.clear,destroy:function(){b.each(function(n){})}}),l=(f=t,n=u.lazyWire,r=function(n){return"table"===ot.name(Yi(n))},e=f.getParam("table_clone_elements"),d=C.isString(e)?R.some(e.split(/[ ,]/)):Array.isArray(e)?R.some(e):R.none(),{deleteRow:(o=function(u,c,l,s){return function(n,t){var e=pt.descendants(n,"td[data-mce-style],th[data-mce-style]");E.each(e,function(n){lt.remove(n,"data-mce-style")});var r=s(),o=y.fromDom(f.getDoc()),i=Wr(ra),a=ve(l,o,d);return c(n)?u(r,n,t,a,i).bind(function(n){return E.each(n.newRows(),function(n){pa(f,n.dom())}),E.each(n.newCells(),function(n){ha(f,n.dom())}),n.cursor().map(function(n){var t=f.dom.createRng();return t.setStart(n.dom(),0),t.setEnd(n.dom(),0),t})}):R.none()}})(Xi.eraseRows,function(n){var t=Mr(n);return!1===r(f)||1<t.rows()},x.noop,n),deleteColumn:o(Xi.eraseColumns,function(n){var t=Mr(n);return!1===r(f)||1<t.columns()},x.noop,n),insertRowsBefore:o(Xi.insertRowsBefore,x.always,x.noop,n),insertRowsAfter:o(Xi.insertRowsAfter,x.always,x.noop,n),insertColumnsBefore:o(Xi.insertColumnsBefore,x.always,br,n),insertColumnsAfter:o(Xi.insertColumnsAfter,x.always,br,n),mergeCells:o(Xi.mergeCells,x.always,x.noop,n),unmergeCells:o(Xi.unmergeCells,x.always,x.noop,n),pasteRowsBefore:o(Xi.pasteRowsBefore,x.always,x.noop,n),pasteRowsAfter:o(Xi.pasteRowsAfter,x.always,x.noop,n),pasteCells:o(Xi.pasteCells,x.always,x.noop,n)}),s=Cl(t),m=qr(R.none());return Ha(t,l,c,s,m),nr(t,s,l,c),kl(t,s),Tl(t),Dl(t),t.on("PreInit",function(){t.serializer.addTempAttr(Ue.firstSelected()),t.serializer.addTempAttr(Ue.lastSelected())}),t.getParam("table_tab_navigation",!0,"boolean")&&t.on("keydown",function(n){ac(n,t,l,u.lazyWire)}),t.on("remove",function(){u.destroy(),c.destroy()}),i=t,a=m,{insertTable:function(n,t){return ja(i,n,t)},setClipboardRows:function(n){return t=n,e=a,r=E.map(t,y.fromDom),void e.set(R.from(r));var t,e,r},getClipboardRows:function(){return a.get().fold(function(){},function(n){return E.map(n,function(n){return n.dom()})})}}})}(jQuery);